import*as tt from"../fs.realpath@1.0.0/index.js";import*as et from"../minimatch@5.1.6/index.js";import*as rt from"../inherits@2.0.4/index.js";import*as it from"events";import*as st from"path";import*as at from"assert";import"util";import*as ot from"fs";import*as nt from"../inflight@1.0.6/index.js";import*as ct from"../once@1.4.0/index.js";function ht(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function T(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var K=T(tt),x=T(et),ft=T(rt),ut=T(it),P=T(st),z=T(at),C={},lt=T(ot);C.setopts=yt,C.ownProp=H,C.makeAbs=q,C.finish=bt,C.mark=gt,C.isIgnored=X,C.childrenIgnored=wt;function H(t,p){return Object.prototype.hasOwnProperty.call(t,p)}var pt=lt,M=P,dt=x,V=P.isAbsolute,U=dt.Minimatch;function mt(t,p){return t.localeCompare(p,"en")}function vt(t,p){t.ignore=p.ignore||[],Array.isArray(t.ignore)||(t.ignore=[t.ignore]),t.ignore.length&&(t.ignore=t.ignore.map(_t))}function _t(t){var p=null;if(t.slice(-3)==="/**"){var o=t.replace(/(\/\*\*)+$/,"");p=new U(o,{dot:!0})}return{matcher:new U(t,{dot:!0}),gmatcher:p}}function yt(t,p,o){if(o||(o={}),o.matchBase&&p.indexOf("/")===-1){if(o.noglobstar)throw new Error("base matching requires globstar");p="**/"+p}t.windowsPathsNoEscape=!!o.windowsPathsNoEscape||o.allowWindowsEscape===!1,t.windowsPathsNoEscape&&(p=p.replace(/\\/g,"/")),t.silent=!!o.silent,t.pattern=p,t.strict=o.strict!==!1,t.realpath=!!o.realpath,t.realpathCache=o.realpathCache||Object.create(null),t.follow=!!o.follow,t.dot=!!o.dot,t.mark=!!o.mark,t.nodir=!!o.nodir,t.nodir&&(t.mark=!0),t.sync=!!o.sync,t.nounique=!!o.nounique,t.nonull=!!o.nonull,t.nosort=!!o.nosort,t.nocase=!!o.nocase,t.stat=!!o.stat,t.noprocess=!!o.noprocess,t.absolute=!!o.absolute,t.fs=o.fs||pt,t.maxLength=o.maxLength||1/0,t.cache=o.cache||Object.create(null),t.statCache=o.statCache||Object.create(null),t.symlinks=o.symlinks||Object.create(null),vt(t,o),t.changedCwd=!1;var g=process.cwd();H(o,"cwd")?(t.cwd=M.resolve(o.cwd),t.changedCwd=t.cwd!==g):t.cwd=M.resolve(g),t.root=o.root||M.resolve(t.cwd,"/"),t.root=M.resolve(t.root),t.cwdAbs=V(t.cwd)?t.cwd:q(t,t.cwd),t.nomount=!!o.nomount,process.platform==="win32"&&(t.root=t.root.replace(/\\/g,"/"),t.cwd=t.cwd.replace(/\\/g,"/"),t.cwdAbs=t.cwdAbs.replace(/\\/g,"/")),o.nonegate=!0,o.nocomment=!0,t.minimatch=new U(p,o),t.options=t.minimatch.options}function bt(t){for(var p=t.nounique,o=p?[]:Object.create(null),g=0,A=t.matches.length;g<A;g++){var E=t.matches[g];if(!E||Object.keys(E).length===0){if(t.nonull){var S=t.minimatch.globSet[g];p?o.push(S):o[S]=!0}}else{var N=Object.keys(E);p?o.push.apply(o,N):N.forEach(function(O){o[O]=!0})}}if(p||(o=Object.keys(o)),t.nosort||(o=o.sort(mt)),t.mark){for(var g=0;g<o.length;g++)o[g]=t._mark(o[g]);t.nodir&&(o=o.filter(function(O){var F=!/\/$/.test(O),L=t.cache[O]||t.cache[q(t,O)];return F&&L&&(F=L!=="DIR"&&!Array.isArray(L)),F}))}t.ignore.length&&(o=o.filter(function(O){return!X(t,O)})),t.found=o}function gt(t,p){var o=q(t,p),g=t.cache[o],A=p;if(g){var E=g==="DIR"||Array.isArray(g),S=p.slice(-1)==="/";if(E&&!S?A+="/":!E&&S&&(A=A.slice(0,-1)),A!==p){var N=q(t,A);t.statCache[N]=t.statCache[o],t.cache[N]=t.cache[o]}}return A}function q(t,p){var o=p;return p.charAt(0)==="/"?o=M.join(t.root,p):V(p)||p===""?o=p:t.changedCwd?o=M.resolve(t.cwd,p):o=M.resolve(p),process.platform==="win32"&&(o=o.replace(/\\/g,"/")),o}function X(t,p){return t.ignore.length?t.ignore.some(function(o){return o.matcher.match(p)||!!(o.gmatcher&&o.gmatcher.match(p))}):!1}function wt(t,p){return t.ignore.length?t.ignore.some(function(o){return!!(o.gmatcher&&o.gmatcher.match(p))}):!1}var B,J;function kt(){if(J)return B;J=1,B=L,L.GlobSync=b;var t=K,p=x;p.Minimatch,Z().Glob;var o=P,g=z,A=P.isAbsolute,E=C,S=E.setopts,N=E.ownProp,O=E.childrenIgnored,F=E.isIgnored;function L(n,f){if(typeof f=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new b(n,f).found}function b(n,f){if(!n)throw new Error("must provide pattern");if(typeof f=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof b))return new b(n,f);if(S(this,n,f),this.noprocess)return this;var m=this.minimatch.set.length;this.matches=new Array(m);for(var h=0;h<m;h++)this._process(this.minimatch.set[h],h,!1);this._finish()}return b.prototype._finish=function(){if(g.ok(this instanceof b),this.realpath){var n=this;this.matches.forEach(function(f,m){var h=n.matches[m]=Object.create(null);for(var v in f)try{v=n._makeAbs(v);var _=t.realpathSync(v,n.realpathCache);h[_]=!0}catch(u){if(u.syscall==="stat")h[n._makeAbs(v)]=!0;else throw u}})}E.finish(this)},b.prototype._process=function(n,f,m){g.ok(this instanceof b);for(var h=0;typeof n[h]=="string";)h++;var v;switch(h){case n.length:this._processSimple(n.join("/"),f);return;case 0:v=null;break;default:v=n.slice(0,h).join("/");break}var _=n.slice(h),u;v===null?u=".":((A(v)||A(n.map(function(r){return typeof r=="string"?r:"[*]"}).join("/")))&&(!v||!A(v))&&(v="/"+v),u=v);var j=this._makeAbs(u);if(!O(this,u)){var e=_[0]===p.GLOBSTAR;e?this._processGlobStar(v,u,j,_,f,m):this._processReaddir(v,u,j,_,f,m)}},b.prototype._processReaddir=function(n,f,m,h,v,_){var u=this._readdir(m,_);if(u){for(var j=h[0],e=!!this.minimatch.negate,r=j._glob,s=this.dot||r.charAt(0)===".",a=[],i=0;i<u.length;i++){var c=u[i];if(c.charAt(0)!=="."||s){var d;e&&!n?d=!c.match(j):d=c.match(j),d&&a.push(c)}}var l=a.length;if(l!==0){if(h.length===1&&!this.mark&&!this.stat){this.matches[v]||(this.matches[v]=Object.create(null));for(var i=0;i<l;i++){var c=a[i];n&&(n.slice(-1)!=="/"?c=n+"/"+c:c=n+c),c.charAt(0)==="/"&&!this.nomount&&(c=o.join(this.root,c)),this._emitMatch(v,c)}return}h.shift();for(var i=0;i<l;i++){var c=a[i],y;n?y=[n,c]:y=[c],this._process(y.concat(h),v,_)}}}},b.prototype._emitMatch=function(n,f){if(!F(this,f)){var m=this._makeAbs(f);if(this.mark&&(f=this._mark(f)),this.absolute&&(f=m),!this.matches[n][f]){if(this.nodir){var h=this.cache[m];if(h==="DIR"||Array.isArray(h))return}this.matches[n][f]=!0,this.stat&&this._stat(f)}}},b.prototype._readdirInGlobStar=function(n){if(this.follow)return this._readdir(n,!1);var f,m;try{m=this.fs.lstatSync(n)}catch(v){if(v.code==="ENOENT")return null}var h=m&&m.isSymbolicLink();return this.symlinks[n]=h,!h&&m&&!m.isDirectory()?this.cache[n]="FILE":f=this._readdir(n,!1),f},b.prototype._readdir=function(n,f){if(f&&!N(this.symlinks,n))return this._readdirInGlobStar(n);if(N(this.cache,n)){var m=this.cache[n];if(!m||m==="FILE")return null;if(Array.isArray(m))return m}try{return this._readdirEntries(n,this.fs.readdirSync(n))}catch(h){return this._readdirError(n,h),null}},b.prototype._readdirEntries=function(n,f){if(!this.mark&&!this.stat)for(var m=0;m<f.length;m++){var h=f[m];n==="/"?h=n+h:h=n+"/"+h,this.cache[h]=!0}return this.cache[n]=f,f},b.prototype._readdirError=function(n,f){switch(f.code){case"ENOTSUP":case"ENOTDIR":var m=this._makeAbs(n);if(this.cache[m]="FILE",m===this.cwdAbs){var h=new Error(f.code+" invalid cwd "+this.cwd);throw h.path=this.cwd,h.code=f.code,h}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(n)]=!1;break;default:if(this.cache[this._makeAbs(n)]=!1,this.strict)throw f;this.silent||console.error("glob error",f);break}},b.prototype._processGlobStar=function(n,f,m,h,v,_){var u=this._readdir(m,_);if(u){var j=h.slice(1),e=n?[n]:[],r=e.concat(j);this._process(r,v,!1);var s=u.length,a=this.symlinks[m];if(!(a&&_))for(var i=0;i<s;i++){var c=u[i];if(!(c.charAt(0)==="."&&!this.dot)){var d=e.concat(u[i],j);this._process(d,v,!0);var l=e.concat(u[i],h);this._process(l,v,!0)}}}},b.prototype._processSimple=function(n,f){var m=this._stat(n);if(this.matches[f]||(this.matches[f]=Object.create(null)),!!m){if(n&&A(n)&&!this.nomount){var h=/[\/\\]$/.test(n);n.charAt(0)==="/"?n=o.join(this.root,n):(n=o.resolve(this.root,n),h&&(n+="/"))}process.platform==="win32"&&(n=n.replace(/\\/g,"/")),this._emitMatch(f,n)}},b.prototype._stat=function(n){var f=this._makeAbs(n),m=n.slice(-1)==="/";if(n.length>this.maxLength)return!1;if(!this.stat&&N(this.cache,f)){var _=this.cache[f];if(Array.isArray(_)&&(_="DIR"),!m||_==="DIR")return _;if(m&&_==="FILE")return!1}var h=this.statCache[f];if(!h){var v;try{v=this.fs.lstatSync(f)}catch(u){if(u&&(u.code==="ENOENT"||u.code==="ENOTDIR"))return this.statCache[f]=!1,!1}if(v&&v.isSymbolicLink())try{h=this.fs.statSync(f)}catch{h=v}else h=v}this.statCache[f]=h;var _=!0;return h&&(_=h.isDirectory()?"DIR":"FILE"),this.cache[f]=this.cache[f]||_,m&&_==="FILE"?!1:_},b.prototype._mark=function(n){return E.mark(this,n)},b.prototype._makeAbs=function(n){return E.makeAbs(this,n)},B}var Et=T(nt),At=T(ct),W,Y;function Z(){if(Y)return W;Y=1,W=h;var t=K,p=x;p.Minimatch;var o=ft,g=ut.EventEmitter,A=P,E=z,S=P.isAbsolute,N=kt(),O=C,F=O.setopts,L=O.ownProp,b=Et,n=O.childrenIgnored,f=O.isIgnored,m=At;function h(e,r,s){if(typeof r=="function"&&(s=r,r={}),r||(r={}),r.sync){if(s)throw new TypeError("callback provided to sync glob");return N(e,r)}return new u(e,r,s)}h.sync=N;var v=h.GlobSync=N.GlobSync;h.glob=h;function _(e,r){if(r===null||typeof r!="object")return e;for(var s=Object.keys(r),a=s.length;a--;)e[s[a]]=r[s[a]];return e}h.hasMagic=function(e,r){var s=_({},r);s.noprocess=!0;var a=new u(e,s),i=a.minimatch.set;if(!e)return!1;if(i.length>1)return!0;for(var c=0;c<i[0].length;c++)if(typeof i[0][c]!="string")return!0;return!1},h.Glob=u,o(u,g);function u(e,r,s){if(typeof r=="function"&&(s=r,r=null),r&&r.sync){if(s)throw new TypeError("callback provided to sync glob");return new v(e,r)}if(!(this instanceof u))return new u(e,r,s);F(this,e,r),this._didRealPath=!1;var a=this.minimatch.set.length;this.matches=new Array(a),typeof s=="function"&&(s=m(s),this.on("error",s),this.on("end",function(y){s(null,y)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(a===0)return l();for(var c=!0,d=0;d<a;d++)this._process(this.minimatch.set[d],d,!1,l);c=!1;function l(){--i._processing,i._processing<=0&&(c?process.nextTick(function(){i._finish()}):i._finish())}}u.prototype._finish=function(){if(E(this instanceof u),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();O.finish(this),this.emit("end",this.found)}},u.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var e=this.matches.length;if(e===0)return this._finish();for(var r=this,s=0;s<this.matches.length;s++)this._realpathSet(s,a);function a(){--e===0&&r._finish()}},u.prototype._realpathSet=function(e,r){var s=this.matches[e];if(!s)return r();var a=Object.keys(s),i=this,c=a.length;if(c===0)return r();var d=this.matches[e]=Object.create(null);a.forEach(function(l,y){l=i._makeAbs(l),t.realpath(l,i.realpathCache,function(I,R){I?I.syscall==="stat"?d[l]=!0:i.emit("error",I):d[R]=!0,--c===0&&(i.matches[e]=d,r())})})},u.prototype._mark=function(e){return O.mark(this,e)},u.prototype._makeAbs=function(e){return O.makeAbs(this,e)},u.prototype.abort=function(){this.aborted=!0,this.emit("abort")},u.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},u.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var r=0;r<e.length;r++){var s=e[r];this._emitMatch(s[0],s[1])}}if(this._processQueue.length){var a=this._processQueue.slice(0);this._processQueue.length=0;for(var r=0;r<a.length;r++){var i=a[r];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}},u.prototype._process=function(e,r,s,a){if(E(this instanceof u),E(typeof a=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([e,r,s,a]);return}for(var i=0;typeof e[i]=="string";)i++;var c;switch(i){case e.length:this._processSimple(e.join("/"),r,a);return;case 0:c=null;break;default:c=e.slice(0,i).join("/");break}var d=e.slice(i),l;c===null?l=".":((S(c)||S(e.map(function(R){return typeof R=="string"?R:"[*]"}).join("/")))&&(!c||!S(c))&&(c="/"+c),l=c);var y=this._makeAbs(l);if(n(this,l))return a();var I=d[0]===p.GLOBSTAR;I?this._processGlobStar(c,l,y,d,r,s,a):this._processReaddir(c,l,y,d,r,s,a)}},u.prototype._processReaddir=function(e,r,s,a,i,c,d){var l=this;this._readdir(s,c,function(y,I){return l._processReaddir2(e,r,s,a,i,c,I,d)})},u.prototype._processReaddir2=function(e,r,s,a,i,c,d,l){if(!d)return l();for(var y=a[0],I=!!this.minimatch.negate,R=y._glob,G=this.dot||R.charAt(0)===".",D=[],k=0;k<d.length;k++){var w=d[k];if(w.charAt(0)!=="."||G){var Q;I&&!e?Q=!w.match(y):Q=w.match(y),Q&&D.push(w)}}var $=D.length;if($===0)return l();if(a.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var k=0;k<$;k++){var w=D[k];e&&(e!=="/"?w=e+"/"+w:w=e+w),w.charAt(0)==="/"&&!this.nomount&&(w=A.join(this.root,w)),this._emitMatch(i,w)}return l()}a.shift();for(var k=0;k<$;k++){var w=D[k];e&&(e!=="/"?w=e+"/"+w:w=e+w),this._process([w].concat(a),i,c,l)}l()},u.prototype._emitMatch=function(e,r){if(!this.aborted&&!f(this,r)){if(this.paused){this._emitQueue.push([e,r]);return}var s=S(r)?r:this._makeAbs(r);if(this.mark&&(r=this._mark(r)),this.absolute&&(r=s),!this.matches[e][r]){if(this.nodir){var a=this.cache[s];if(a==="DIR"||Array.isArray(a))return}this.matches[e][r]=!0;var i=this.statCache[s];i&&this.emit("stat",r,i),this.emit("match",r)}}},u.prototype._readdirInGlobStar=function(e,r){if(this.aborted)return;if(this.follow)return this._readdir(e,!1,r);var s="lstat\0"+e,a=this,i=b(s,c);i&&a.fs.lstat(e,i);function c(d,l){if(d&&d.code==="ENOENT")return r();var y=l&&l.isSymbolicLink();a.symlinks[e]=y,!y&&l&&!l.isDirectory()?(a.cache[e]="FILE",r()):a._readdir(e,!1,r)}},u.prototype._readdir=function(e,r,s){if(!this.aborted&&(s=b("readdir\0"+e+"\0"+r,s),!!s)){if(r&&!L(this.symlinks,e))return this._readdirInGlobStar(e,s);if(L(this.cache,e)){var a=this.cache[e];if(!a||a==="FILE")return s();if(Array.isArray(a))return s(null,a)}var i=this;i.fs.readdir(e,j(this,e,s))}};function j(e,r,s){return function(a,i){a?e._readdirError(r,a,s):e._readdirEntries(r,i,s)}}return u.prototype._readdirEntries=function(e,r,s){if(!this.aborted){if(!this.mark&&!this.stat)for(var a=0;a<r.length;a++){var i=r[a];e==="/"?i=e+i:i=e+"/"+i,this.cache[i]=!0}return this.cache[e]=r,s(null,r)}},u.prototype._readdirError=function(e,r,s){if(!this.aborted){switch(r.code){case"ENOTSUP":case"ENOTDIR":var a=this._makeAbs(e);if(this.cache[a]="FILE",a===this.cwdAbs){var i=new Error(r.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=r.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:this.cache[this._makeAbs(e)]=!1,this.strict&&(this.emit("error",r),this.abort()),this.silent||console.error("glob error",r);break}return s()}},u.prototype._processGlobStar=function(e,r,s,a,i,c,d){var l=this;this._readdir(s,c,function(y,I){l._processGlobStar2(e,r,s,a,i,c,I,d)})},u.prototype._processGlobStar2=function(e,r,s,a,i,c,d,l){if(!d)return l();var y=a.slice(1),I=e?[e]:[],R=I.concat(y);this._process(R,i,!1,l);var G=this.symlinks[s],D=d.length;if(G&&c)return l();for(var k=0;k<D;k++){var w=d[k];if(!(w.charAt(0)==="."&&!this.dot)){var Q=I.concat(d[k],y);this._process(Q,i,!0,l);var $=I.concat(d[k],a);this._process($,i,!0,l)}}l()},u.prototype._processSimple=function(e,r,s){var a=this;this._stat(e,function(i,c){a._processSimple2(e,r,i,c,s)})},u.prototype._processSimple2=function(e,r,s,a,i){if(this.matches[r]||(this.matches[r]=Object.create(null)),!a)return i();if(e&&S(e)&&!this.nomount){var c=/[\/\\]$/.test(e);e.charAt(0)==="/"?e=A.join(this.root,e):(e=A.resolve(this.root,e),c&&(e+="/"))}process.platform==="win32"&&(e=e.replace(/\\/g,"/")),this._emitMatch(r,e),i()},u.prototype._stat=function(e,r){var s=this._makeAbs(e),a=e.slice(-1)==="/";if(e.length>this.maxLength)return r();if(!this.stat&&L(this.cache,s)){var i=this.cache[s];if(Array.isArray(i)&&(i="DIR"),!a||i==="DIR")return r(null,i);if(a&&i==="FILE")return r()}var c=this.statCache[s];if(c!==void 0){if(c===!1)return r(null,c);var d=c.isDirectory()?"DIR":"FILE";return a&&d==="FILE"?r():r(null,d,c)}var l=this,y=b("stat\0"+s,I);y&&l.fs.lstat(s,y);function I(R,G){if(G&&G.isSymbolicLink())return l.fs.stat(s,function(D,k){D?l._stat2(e,s,null,G,r):l._stat2(e,s,D,k,r)});l._stat2(e,s,R,G,r)}},u.prototype._stat2=function(e,r,s,a,i){if(s&&(s.code==="ENOENT"||s.code==="ENOTDIR"))return this.statCache[r]=!1,i();var c=e.slice(-1)==="/";if(this.statCache[r]=a,r.slice(-1)==="/"&&a&&!a.isDirectory())return i(null,!1,a);var d=!0;return a&&(d=a.isDirectory()?"DIR":"FILE"),this.cache[r]=this.cache[r]||d,c&&d==="FILE"?i():i(null,d,a)},W}var Ot=Z(),It=ht(Ot);export{It as default};
