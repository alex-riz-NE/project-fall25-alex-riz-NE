import p from"../string-width@5.1.2/index.js";import S from"../strip-ansi@7.1.2/index.js";import b from"../ansi-styles@6.2.3/index.js";const m=new Set(["\x1B","\x9B"]),N=39,d="\x07",v="[",B="]",j="m",$=`${B}8;;`,w=t=>`${m.values().next().value}${v}${t}${j}`,W=t=>`${m.values().next().value}${$}${t}${d}`,E=t=>t.split(" ").map(e=>p(e)),x=(t,e,r)=>{const n=[...e];let a=!1,c=!1,l=p(S(t[t.length-1]));for(const[o,f]of n.entries()){const s=p(f);if(l+s<=r?t[t.length-1]+=f:(t.push(f),l=0),m.has(f)&&(a=!0,c=n.slice(o+1).join("").startsWith($)),a){c?f===d&&(a=!1,c=!1):f===j&&(a=!1);continue}l+=s,l===r&&o<n.length-1&&(t.push(""),l=0)}!l&&t[t.length-1].length>0&&t.length>1&&(t[t.length-2]+=t.pop())},M=t=>{const e=t.split(" ");let r=e.length;for(;r>0&&!(p(e[r-1])>0);)r--;return r===e.length?t:e.slice(0,r).join(" ")+e.slice(r).join("")},k=(t,e,r={})=>{if(r.trim!==!1&&t.trim()==="")return"";let n="",a,c;const l=E(t);let o=[""];for(const[s,u]of t.split(" ").entries()){r.trim!==!1&&(o[o.length-1]=o[o.length-1].trimStart());let i=p(o[o.length-1]);if(s!==0&&(i>=e&&(r.wordWrap===!1||r.trim===!1)&&(o.push(""),i=0),(i>0||r.trim===!1)&&(o[o.length-1]+=" ",i++)),r.hard&&l[s]>e){const h=e-i,g=1+Math.floor((l[s]-h-1)/e);Math.floor((l[s]-1)/e)<g&&o.push(""),x(o,u,e);continue}if(i+l[s]>e&&i>0&&l[s]>0){if(r.wordWrap===!1&&i<e){x(o,u,e);continue}o.push("")}if(i+l[s]>e&&r.wordWrap===!1){x(o,u,e);continue}o[o.length-1]+=u}r.trim!==!1&&(o=o.map(s=>M(s)));const f=[...o.join(`
`)];for(const[s,u]of f.entries()){if(n+=u,m.has(u)){const{groups:h}=new RegExp(`(?:\\${v}(?<code>\\d+)m|\\${$}(?<uri>.*)${d})`).exec(f.slice(s).join(""))||{groups:{}};if(h.code!==void 0){const g=Number.parseFloat(h.code);a=g===N?void 0:g}else h.uri!==void 0&&(c=h.uri.length===0?void 0:h.uri)}const i=b.codes.get(Number(a));f[s+1]===`
`?(c&&(n+=W("")),a&&i&&(n+=w(i))):u===`
`&&(a&&i&&(n+=w(a)),c&&(n+=W(c)))}return n};function z(t,e,r){return String(t).normalize().replace(/\r\n/g,`
`).split(`
`).map(n=>k(n,e,r)).join(`
`)}export{z as default};
