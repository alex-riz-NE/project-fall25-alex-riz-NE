var I=44,B=59,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",G=new Uint8Array(64),N=new Uint8Array(128);for(let t=0;t<D.length;t++){const n=D.charCodeAt(t);G[t]=n,N[n]=t}function h(t,n){let e=0,o=0,s=0;do{const u=t.next();s=N[u],e|=(s&31)<<o,o+=5}while(s&32);const c=e&1;return e>>>=1,c&&(e=-2147483648|-e),n+e}function i(t,n,e){let o=n-e;o=o<0?-o<<1|1:o<<1;do{let s=o&31;o>>>=5,o>0&&(s|=32),t.write(G[s])}while(o>0);return n}function v(t,n){return t.pos>=n?!1:t.peek()!==I}var U=1024*16,M=typeof TextDecoder<"u"?new TextDecoder:typeof Buffer<"u"?{decode(t){return Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString()}}:{decode(t){let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return n}},R=class{constructor(){this.pos=0,this.out="",this.buffer=new Uint8Array(U)}write(t){const{buffer:n}=this;n[this.pos++]=t,this.pos===U&&(this.out+=M.decode(n),this.pos=0)}flush(){const{buffer:t,out:n,pos:e}=this;return e>0?n+M.decode(t.subarray(0,e)):n}},T=class{constructor(t){this.pos=0,this.buffer=t}next(){return this.buffer.charCodeAt(this.pos++)}peek(){return this.buffer.charCodeAt(this.pos)}indexOf(t){const{buffer:n,pos:e}=this,o=n.indexOf(t,e);return o===-1?n.length:o}},j=[];function Y(t){const{length:n}=t,e=new T(t),o=[],s=[];let c=0;for(;e.pos<n;e.pos++){c=h(e,c);const u=h(e,0);if(!v(e,n)){const p=s.pop();p[2]=c,p[3]=u;continue}const r=h(e,0),f=h(e,0)&1?[c,u,0,0,r,h(e,0)]:[c,u,0,0,r];let g=j;if(v(e,n)){g=[];do{const p=h(e,0);g.push(p)}while(v(e,n))}f.vars=g,o.push(f),s.push(f)}return o}function _(t){const n=new R;for(let e=0;e<t.length;)e=q(t,e,n,[0]);return n.flush()}function q(t,n,e,o){const s=t[n],{0:c,1:u,2:r,3:a,4:d,vars:f}=s;n>0&&e.write(I),o[0]=i(e,c,o[0]),i(e,u,0),i(e,d,0);const g=s.length===6?1:0;i(e,g,0),s.length===6&&i(e,s[5],0);for(const p of f)i(e,p,0);for(n++;n<t.length;){const p=t[n],{0:l,1:m}=p;if(l>r||l===r&&m>=a)break;n=q(t,n,e,o)}return e.write(I),o[0]=i(e,r,o[0]),i(e,a,0),n}function z(t){const{length:n}=t,e=new T(t),o=[],s=[];let c=0,u=0,r=0,a=0,d=0,f=0,g=0,p=0;do{const l=e.indexOf(";");let m=0;for(;e.pos<l;e.pos++){if(m=h(e,m),!v(e,l)){const C=s.pop();C[2]=c,C[3]=m;continue}const b=h(e,0),A=b&1,L=b&2,k=b&4;let w=null,O=j,S;if(A){const C=h(e,u);r=h(e,u===C?r:0),u=C,S=[c,m,0,0,C,r]}else S=[c,m,0,0];if(S.isScope=!!k,L){const C=a,x=d;a=h(e,a);const y=C===a;d=h(e,y?d:0),f=h(e,y&&x===d?f:0),w=[a,d,f]}if(S.callsite=w,v(e,l)){O=[];do{g=c,p=m;const C=h(e,0);let x;if(C<-1){x=[[h(e,0)]];for(let y=-1;y>C;y--){const V=g;g=h(e,g),p=h(e,g===V?p:0);const W=h(e,0);x.push([W,g,p])}}else x=[[C]];O.push(x)}while(v(e,l))}S.bindings=O,o.push(S),s.push(S)}c++,e.pos=l+1}while(e.pos<n);return o}function F(t){if(t.length===0)return"";const n=new R;for(let e=0;e<t.length;)e=E(t,e,n,[0,0,0,0,0,0,0]);return n.flush()}function E(t,n,e,o){const s=t[n],{0:c,1:u,2:r,3:a,isScope:d,callsite:f,bindings:g}=s;o[0]<c?(P(e,o[0],c),o[0]=c,o[1]=0):n>0&&e.write(I),o[1]=i(e,s[1],o[1]);const p=(s.length===6?1:0)|(f?2:0)|(d?4:0);if(i(e,p,0),s.length===6){const{4:l,5:m}=s;l!==o[2]&&(o[3]=0),o[2]=i(e,l,o[2]),o[3]=i(e,m,o[3])}if(f){const{0:l,1:m,2:b}=s.callsite;l!==o[4]?(o[5]=0,o[6]=0):m!==o[5]&&(o[6]=0),o[4]=i(e,l,o[4]),o[5]=i(e,m,o[5]),o[6]=i(e,b,o[6])}if(g)for(const l of g){l.length>1&&i(e,-l.length,0);const m=l[0][0];i(e,m,0);let b=c,A=u;for(let L=1;L<l.length;L++){const k=l[L];b=i(e,k[1],b),A=i(e,k[2],A),i(e,k[0],0)}}for(n++;n<t.length;){const l=t[n],{0:m,1:b}=l;if(m>r||m===r&&b>=a)break;n=E(t,n,e,o)}return o[0]<r?(P(e,o[0],r),o[0]=r,o[1]=0):e.write(I),o[1]=i(e,a,o[1]),n}function P(t,n,e){do t.write(B);while(++n<e)}function H(t){const{length:n}=t,e=new T(t),o=[];let s=0,c=0,u=0,r=0,a=0;do{const d=e.indexOf(";"),f=[];let g=!0,p=0;for(s=0;e.pos<d;){let l;s=h(e,s),s<p&&(g=!1),p=s,v(e,d)?(c=h(e,c),u=h(e,u),r=h(e,r),v(e,d)?(a=h(e,a),l=[s,c,u,r,a]):l=[s,c,u,r]):l=[s],f.push(l),e.pos++}g||J(f),o.push(f),e.pos=d+1}while(e.pos<=n);return o}function J(t){t.sort(K)}function K(t,n){return t[0]-n[0]}function Q(t){const n=new R;let e=0,o=0,s=0,c=0;for(let u=0;u<t.length;u++){const r=t[u];if(u>0&&n.write(B),r.length===0)continue;let a=0;for(let d=0;d<r.length;d++){const f=r[d];d>0&&n.write(I),a=i(n,f[0],a),f.length!==1&&(e=i(n,f[1],e),o=i(n,f[2],o),s=i(n,f[3],s),f.length!==4&&(c=i(n,f[4],c)))}}return n.flush()}export{H as decode,z as decodeGeneratedRanges,Y as decodeOriginalScopes,Q as encode,F as encodeGeneratedRanges,_ as encodeOriginalScopes};
