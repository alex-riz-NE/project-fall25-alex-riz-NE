import*as T from"child_process";import*as C from"path";import*as P from"../which@2.0.2/index.js";import*as A from"../path-key@3.1.1/index.js";import*as F from"fs";import*as k from"../shebang-command@2.0.0/index.js";function m(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function a(r){return r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var e={exports:{}},D=a(T),h=a(C),z=a(P),B=a(A);const y=h,I=z,K=B;function v(r,n){const o=r.options.env||process.env,t=process.cwd(),s=r.options.cwd!=null,c=s&&process.chdir!==void 0&&!process.chdir.disabled;if(c)try{process.chdir(r.options.cwd)}catch{}let i;try{i=I.sync(r.command,{path:o[K({env:o})],pathExt:n?y.delimiter:void 0})}catch{}finally{c&&process.chdir(t)}return i&&(i=y.resolve(s?r.options.cwd:"",i)),i}function M(r){return v(r)||v(r,!0)}var w=M;m(w);var p={};const l=/([()\][%!^"`<>&|;, *?])/g;function V(r){return r=r.replace(l,"^$1"),r}function q(r,n){return r=`${r}`,r=r.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),r=r.replace(/(?=(\\+?)?)\1$/,"$1$1"),r=`"${r}"`,r=r.replace(l,"^$1"),n&&(r=r.replace(l,"^$1")),r}p.command=V,p.argument=q;var G=a(F),H=a(k);const u=G,J=H;function L(r){const n=Buffer.alloc(150);let o;try{o=u.openSync(r,"r"),u.readSync(o,n,0,150,0),u.closeSync(o)}catch{}return J(n.toString())}var _=L;m(_);const Q=h,E=w,N=p,R=_,U=process.platform==="win32",W=/\.(?:com|exe)$/i,X=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function Y(r){r.file=E(r);const n=r.file&&R(r.file);return n?(r.args.unshift(r.file),r.command=n,E(r)):r.file}function Z(r){if(!U)return r;const n=Y(r),o=!W.test(n);if(r.options.forceShell||o){const t=X.test(n);r.command=Q.normalize(r.command),r.command=N.command(r.command),r.args=r.args.map(c=>N.argument(c,t));const s=[r.command].concat(r.args).join(" ");r.args=["/d","/s","/c",`"${s}"`],r.command=process.env.comspec||"cmd.exe",r.options.windowsVerbatimArguments=!0}return r}function rr(r,n,o){n&&!Array.isArray(n)&&(o=n,n=null),n=n?n.slice(0):[],o=Object.assign({},o);const t={command:r,args:n,options:o,file:void 0,original:{command:r,args:n}};return o.shell?t:Z(t)}var x=rr;m(x);const f=process.platform==="win32";function d(r,n){return Object.assign(new Error(`${n} ${r.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${n} ${r.command}`,path:r.command,spawnargs:r.args})}function nr(r,n){if(!f)return;const o=r.emit;r.emit=function(t,s){if(t==="exit"){const c=O(s,n);if(c)return o.call(r,"error",c)}return o.apply(r,arguments)}}function O(r,n){return f&&r===1&&!n.file?d(n.original,"spawn"):null}function or(r,n){return f&&r===1&&!n.file?d(n.original,"spawnSync"):null}var S={hookChildProcess:nr,verifyENOENT:O,verifyENOENTSync:or,notFoundError:d};m(S);const b=D,$=x,g=S;function j(r,n,o){const t=$(r,n,o),s=b.spawn(t.command,t.args,t.options);return g.hookChildProcess(s,t),s}function tr(r,n,o){const t=$(r,n,o),s=b.spawnSync(t.command,t.args,t.options);return s.error=s.error||g.verifyENOENTSync(s.status,t),s}e.exports=j;var sr=e.exports.spawn=j,cr=e.exports.sync=tr,ar=e.exports._parse=$,er=e.exports._enoent=g,ir=e.exports,mr=m(ir);export{er as _enoent,ar as _parse,mr as default,sr as spawn,cr as sync};
