const h=n=>n!==null&&typeof n=="object",a=(n,e)=>Object.assign(new Error(`[${n}]: ${e}`),{code:n}),g="ERR_INVALID_PACKAGE_CONFIG",p="ERR_INVALID_PACKAGE_TARGET",A="ERR_PACKAGE_PATH_NOT_EXPORTED",w="ERR_PACKAGE_IMPORT_NOT_DEFINED",_=/^\d+$/,y=/^(\.{1,2}|node_modules)$/i,I=/\/|\\/;var l=(n=>(n.Export="exports",n.Import="imports",n))(l||{});const c=(n,e,t,i,r)=>{if(e==null)return[];if(typeof e=="string"){const[o,...s]=e.split(I);if(o===".."||s.some(d=>y.test(d)))throw a(p,`Invalid "${n}" target "${e}" defined in the package config`);return[r?e.replace(/\*/g,r):e]}if(Array.isArray(e))return e.flatMap(o=>c(n,o,t,i,r));if(h(e)){for(const o of Object.keys(e)){if(_.test(o))throw a(g,"Cannot contain numeric property keys");if(o==="default"||i.includes(o))return c(n,e[o],t,i,r)}return[]}throw a(p,`Invalid "${n}" target "${e}"`)},f="*",m=(n,e)=>{const t=n.indexOf(f),i=e.indexOf(f);return t===i?e.length>n.length:i>t};function E(n,e){if(!e.includes(f)&&n.hasOwnProperty(e))return[e];let t,i;for(const r of Object.keys(n))if(r.includes(f)){const[o,s,d]=r.split(f);if(d===void 0&&e.startsWith(o)&&e.endsWith(s)){const u=e.slice(o.length,-s.length||void 0);u&&(!t||m(t,r))&&(t=r,i=u)}}return[t,i]}const O=n=>Object.keys(n).reduce((e,t)=>{const i=t===""||t[0]!==".";if(e===void 0||e===i)return i;throw a(g,'"exports" cannot contain some keys starting with "." and some not')},void 0),x=/^\w+:/,R=(n,e,t)=>{if(!n)throw new Error('"exports" is required');e=e===""?".":`./${e}`,(typeof n=="string"||Array.isArray(n)||h(n)&&O(n))&&(n={".":n});const[i,r]=E(n,e),o=c(l.Export,n[i],e,t,r);if(o.length===0)throw a(A,e==="."?'No "exports" main defined':`Package subpath '${e}' is not defined by "exports"`);for(const s of o)if(!s.startsWith("./")&&!x.test(s))throw a(p,`Invalid "exports" target "${s}" defined in the package config`);return o},$=(n,e,t)=>{if(!n)throw new Error('"imports" is required');const[i,r]=E(n,e),o=c(l.Import,n[i],e,t,r);if(o.length===0)throw a(w,`Package import specifier "${e}" is not defined in package`);return o};export{R as resolveExports,$ as resolveImports};
