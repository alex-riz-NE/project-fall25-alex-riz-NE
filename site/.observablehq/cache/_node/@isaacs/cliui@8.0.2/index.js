import y from"../../string-width@5.1.2/index.js";import W from"../../strip-ansi@7.1.2/index.js";import x from"../../wrap-ansi@8.1.0/index.js";const S={right:b,center:D},v=0,l=1,E=2,c=3;class P{constructor(t){var i;this.width=t.width,this.wrap=(i=t.wrap)!==null&&i!==void 0?i:!0,this.rows=[]}span(...t){const i=this.div(...t);i.span=!0}resetOutput(){this.rows=[]}div(...t){if(t.length===0&&this.div(""),this.wrap&&this.shouldApplyLayoutDSL(...t)&&typeof t[0]=="string")return this.applyLayoutDSL(t[0]);const i=t.map(h=>typeof h=="string"?this.colFromString(h):h);return this.rows.push(i),i}shouldApplyLayoutDSL(...t){return t.length===1&&typeof t[0]=="string"&&/[\t\n]/.test(t[0])}applyLayoutDSL(t){const i=t.split(`
`).map(n=>n.split("	"));let h=0;return i.forEach(n=>{n.length>1&&o.stringWidth(n[0])>h&&(h=Math.min(Math.floor(this.width*.5),o.stringWidth(n[0])))}),i.forEach(n=>{this.div(...n.map((r,s)=>({text:r.trim(),padding:this.measurePadding(r),width:s===0&&n.length>1?h:void 0})))}),this.rows[this.rows.length-1]}colFromString(t){return{text:t,padding:this.measurePadding(t)}}measurePadding(t){const i=o.stripAnsi(t);return[0,i.match(/\s*$/)[0].length,0,i.match(/^\s*/)[0].length]}toString(){const t=[];return this.rows.forEach(i=>{this.rowToString(i,t)}),t.filter(i=>!i.hidden).map(i=>i.text).join(`
`)}rowToString(t,i){return this.rasterize(t).forEach((h,n)=>{let r="";h.forEach((s,d)=>{const{width:g}=t[d],p=this.negatePadding(t[d]);let a=s;if(p>o.stringWidth(s)&&(a+=" ".repeat(p-o.stringWidth(s))),t[d].align&&t[d].align!=="left"&&this.wrap){const f=S[t[d].align];if(a=f(a,p),o.stringWidth(a)<p){const m=g||0;a+=" ".repeat(m-o.stringWidth(a)-1)}}const u=t[d].padding||[0,0,0,0];u[c]&&(r+=" ".repeat(u[c])),r+=w(t[d],a,"| "),r+=a,r+=w(t[d],a," |"),u[l]&&(r+=" ".repeat(u[l])),n===0&&i.length>0&&(r=this.renderInline(r,i[i.length-1]))}),i.push({text:r.replace(/ +$/,""),span:t.span})}),i}renderInline(t,i){const h=t.match(/^ */),n=h?h[0].length:0,r=i.text,s=o.stringWidth(r.trimEnd());return i.span?this.wrap?n<s?t:(i.hidden=!0,r.trimEnd()+" ".repeat(n-s)+t.trimStart()):(i.hidden=!0,r+t):t}rasterize(t){const i=[],h=this.columnWidths(t);let n;return t.forEach((r,s)=>{r.width=h[s],this.wrap?n=o.wrap(r.text,this.negatePadding(r),{hard:!0}).split(`
`):n=r.text.split(`
`),r.border&&(n.unshift("."+"-".repeat(this.negatePadding(r)+2)+"."),n.push("'"+"-".repeat(this.negatePadding(r)+2)+"'")),r.padding&&(n.unshift(...new Array(r.padding[v]||0).fill("")),n.push(...new Array(r.padding[E]||0).fill(""))),n.forEach((d,g)=>{i[g]||i.push([]);const p=i[g];for(let a=0;a<s;a++)p[a]===void 0&&p.push("");p.push(d)})}),i}negatePadding(t){let i=t.width||0;return t.padding&&(i-=(t.padding[c]||0)+(t.padding[l]||0)),t.border&&(i-=4),i}columnWidths(t){if(!this.wrap)return t.map(s=>s.width||o.stringWidth(s.text));let i=t.length,h=this.width;const n=t.map(s=>{if(s.width)return i--,h-=s.width,s.width}),r=i?Math.floor(h/i):0;return n.map((s,d)=>s===void 0?Math.max(r,L(t[d])):s)}}function w(e,t,i){return e.border?/[.']-+[.']/.test(t)?"":t.trim().length!==0?i:"  ":""}function L(e){const t=e.padding||[],i=1+(t[c]||0)+(t[l]||0);return e.border?i+4:i}function A(){return typeof process=="object"&&process.stdout&&process.stdout.columns?process.stdout.columns:80}function b(e,t){e=e.trim();const i=o.stringWidth(e);return i<t?" ".repeat(t-i)+e:e}function D(e,t){e=e.trim();const i=o.stringWidth(e);return i>=t?e:" ".repeat(t-i>>1)+e}let o;function M(e,t){return o=t,new P({width:e?.width||A(),wrap:e?.wrap})}function j(e){return M(e,{stringWidth:y,stripAnsi:W,wrap:x})}export{j as default};
