import{promisify as t}from"node:util";import r from"node:process";import{execFile as n}from"node:child_process";import c from"../default-browser-id@5.0.1/index.js";import f from"../bundle-name@4.1.0/index.js";const p=t(n),d={MSEdgeHTM:{name:"Edge",id:"com.microsoft.edge"},MSEdgeBHTML:{name:"Edge Beta",id:"com.microsoft.edge.beta"},MSEdgeDHTML:{name:"Edge Dev",id:"com.microsoft.edge.dev"},AppXq0fevzme2pys62n3e0fbqa7peapykr8v:{name:"Edge",id:"com.microsoft.edge.old"},ChromeHTML:{name:"Chrome",id:"com.google.chrome"},ChromeBHTML:{name:"Chrome Beta",id:"com.google.chrome.beta"},ChromeDHTML:{name:"Chrome Dev",id:"com.google.chrome.dev"},ChromiumHTM:{name:"Chromium",id:"org.chromium.Chromium"},BraveHTML:{name:"Brave",id:"com.brave.Browser"},BraveBHTML:{name:"Brave Beta",id:"com.brave.Browser.beta"},BraveDHTML:{name:"Brave Dev",id:"com.brave.Browser.dev"},BraveSSHTM:{name:"Brave Nightly",id:"com.brave.Browser.nightly"},FirefoxURL:{name:"Firefox",id:"org.mozilla.firefox"},OperaStable:{name:"Opera",id:"com.operasoftware.Opera"},VivaldiHTM:{name:"Vivaldi",id:"com.vivaldi.Vivaldi"},"IE.HTTP":{name:"Internet Explorer",id:"com.microsoft.ie"}},l=new Map(Object.entries(d));class s extends Error{}async function g(e=p){const{stdout:o}=await e("reg",["QUERY"," HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice","/v","ProgId"]),i=/ProgId\s*REG_SZ\s*(?<id>\S+)/.exec(o);if(!i)throw new s(`Cannot find Windows browser in stdout: ${JSON.stringify(o)}`);const{id:a}=i.groups,m=d[a];if(!m)throw new s(`Unknown browser ID: ${a}`);return m}const w=t(n),v=e=>e.toLowerCase().replaceAll(/(?:^|\s|-)\S/g,o=>o.toUpperCase());async function h(){if(r.platform==="darwin"){const e=await c();return{name:await f(e),id:e}}if(r.platform==="linux"){const{stdout:e}=await w("xdg-mime",["query","default","x-scheme-handler/http"]),o=e.trim();return{name:v(o.replace(/.desktop$/,"").replace("-"," ")),id:o}}if(r.platform==="win32")return g();throw new Error("Only macOS, Linux, and Windows are supported")}export{l as _windowsBrowserProgIdMap,h as default};
