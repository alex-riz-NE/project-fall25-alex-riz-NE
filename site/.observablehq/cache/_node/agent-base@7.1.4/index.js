import*as E from"net";import*as M from"http";import*as N from"https";var u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function x(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function b(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v={},A=b(E),O=b(M),_=b(N),p={},B=u&&u.__createBinding||(Object.create?function(e,r,o,i){i===void 0&&(i=o);var l=Object.getOwnPropertyDescriptor(r,o);(!l||("get"in l?!r.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(e,i,l)}:function(e,r,o,i){i===void 0&&(i=o),e[i]=r[o]}),D=u&&u.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),S=u&&u.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var o in e)o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)&&B(r,e,o);return D(r,e),r};Object.defineProperty(p,"__esModule",{value:!0}),p.req=p.json=p.toBuffer=void 0;const q=S(O),C=S(_);async function j(e){let r=0;const o=[];for await(const i of e)r+=i.length,o.push(i);return Buffer.concat(o,r)}p.toBuffer=j;async function T(e){const r=(await j(e)).toString("utf8");try{return JSON.parse(r)}catch(o){const i=o;throw i.message+=` (input: ${r})`,i}}p.json=T;function F(e,r={}){const o=((typeof e=="string"?e:e.href).startsWith("https:")?C:q).request(e,r),i=new Promise((l,h)=>{o.once("response",l).once("error",h).end()});return o.then=i.then.bind(i),o}p.req=F,function(e){var r=u&&u.__createBinding||(Object.create?function(s,t,n,c){c===void 0&&(c=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(s,c,a)}:function(s,t,n,c){c===void 0&&(c=n),s[c]=t[n]}),o=u&&u.__setModuleDefault||(Object.create?function(s,t){Object.defineProperty(s,"default",{enumerable:!0,value:t})}:function(s,t){s.default=t}),i=u&&u.__importStar||function(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var n in s)n!=="default"&&Object.prototype.hasOwnProperty.call(s,n)&&r(t,s,n);return o(t,s),t},l=u&&u.__exportStar||function(s,t){for(var n in s)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&r(t,s,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.Agent=void 0;const h=i(A),m=i(O),k=_;l(p,e);const f=Symbol("AgentBaseInternalState");class w extends m.Agent{constructor(t){super(t),this[f]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}const{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(c=>c.indexOf("(https.js:")!==-1||c.indexOf("node:https:")!==-1)}incrementSockets(t){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[t]||(this.sockets[t]=[]);const n=new h.Socket({writable:!1});return this.sockets[t].push(n),this.totalSocketCount++,n}decrementSockets(t,n){if(!this.sockets[t]||n===null)return;const c=this.sockets[t],a=c.indexOf(n);a!==-1&&(c.splice(a,1),this.totalSocketCount--,c.length===0&&delete this.sockets[t])}getName(t){return this.isSecureEndpoint(t)?k.Agent.prototype.getName.call(this,t):super.getName(t)}createSocket(t,n,c){const a={...n,secureEndpoint:this.isSecureEndpoint(n)},g=this.getName(a),y=this.incrementSockets(g);Promise.resolve().then(()=>this.connect(t,a)).then(d=>{if(this.decrementSockets(g,y),d instanceof m.Agent)try{return d.addRequest(t,a)}catch(P){return c(P)}this[f].currentSocket=d,super.createSocket(t,n,c)},d=>{this.decrementSockets(g,y),c(d)})}createConnection(){const t=this[f].currentSocket;if(this[f].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[f].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[f]&&(this[f].defaultPort=t)}get protocol(){return this[f].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[f]&&(this[f].protocol=t)}}e.Agent=w}(v);var G=x(v);export{G as default};
