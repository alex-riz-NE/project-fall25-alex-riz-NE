import m from"../string-width@7.2.0/index.js";import W from"../strip-ansi@7.1.2/index.js";import A from"../ansi-styles@6.2.3/index.js";const d=new Set(["\x1B","\x9B"]),B=39,v="\x07",w="[",E="]",S="m",$=`${E}8;;`,b=e=>`${d.values().next().value}${w}${e}${S}`,N=e=>`${d.values().next().value}${$}${e}${v}`,M=e=>e.split(" ").map(t=>m(t)),x=(e,t,o)=>{const s=[...t];let i=!1,u=!1,l=m(W(e.at(-1)));for(const[n,f]of s.entries()){const h=m(f);if(l+h<=o?e[e.length-1]+=f:(e.push(f),l=0),d.has(f)&&(i=!0,u=s.slice(n+1,n+1+$.length).join("")===$),i){u?f===v&&(i=!1,u=!1):f===S&&(i=!1);continue}l+=h,l===o&&n<s.length-1&&(e.push(""),l=0)}!l&&e.at(-1).length>0&&e.length>1&&(e[e.length-2]+=e.pop())},R=e=>{const t=e.split(" ");let o=t.length;for(;o>0&&!(m(t[o-1])>0);)o--;return o===t.length?e:t.slice(0,o).join(" ")+t.slice(o).join("")},k=(e,t,o={})=>{if(o.trim!==!1&&e.trim()==="")return"";let s="",i,u;const l=M(e);let n=[""];for(const[a,c]of e.split(" ").entries()){o.trim!==!1&&(n[n.length-1]=n.at(-1).trimStart());let r=m(n.at(-1));if(a!==0&&(r>=t&&(o.wordWrap===!1||o.trim===!1)&&(n.push(""),r=0),(r>0||o.trim===!1)&&(n[n.length-1]+=" ",r++)),o.hard&&l[a]>t){const p=t-r,g=1+Math.floor((l[a]-p-1)/t);Math.floor((l[a]-1)/t)<g&&n.push(""),x(n,c,t);continue}if(r+l[a]>t&&r>0&&l[a]>0){if(o.wordWrap===!1&&r<t){x(n,c,t);continue}n.push("")}if(r+l[a]>t&&o.wordWrap===!1){x(n,c,t);continue}n[n.length-1]+=c}o.trim!==!1&&(n=n.map(a=>R(a)));const f=n.join(`
`),h=[...f];let j=0;for(const[a,c]of h.entries()){if(s+=c,d.has(c)){const{groups:p}=new RegExp(`(?:\\${w}(?<code>\\d+)m|\\${$}(?<uri>.*)${v})`).exec(f.slice(j))||{groups:{}};if(p.code!==void 0){const g=Number.parseFloat(p.code);i=g===B?void 0:g}else p.uri!==void 0&&(u=p.uri.length===0?void 0:p.uri)}const r=A.codes.get(Number(i));h[a+1]===`
`?(u&&(s+=N("")),i&&r&&(s+=b(r))):c===`
`&&(i&&r&&(s+=b(i)),u&&(s+=N(u))),j+=c.length}return s};function z(e,t,o){return String(e).normalize().replaceAll(`\r
`,`
`).split(`
`).map(s=>k(s,t,o)).join(`
`)}export{z as default};
