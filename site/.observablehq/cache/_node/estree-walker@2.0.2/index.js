class u{constructor(){this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.context={skip:()=>this.should_skip=!0,remove:()=>this.should_remove=!0,replace:t=>this.replacement=t}}replace(t,e,l,r){t&&(l!==null?t[e][l]=r:t[e]=r)}remove(t,e,l){t&&(l!==null?t[e].splice(l,1):delete t[e])}}class c extends u{constructor(t,e){super(),this.enter=t,this.leave=e}visit(t,e,l,r){if(t){if(this.enter){const h=this.should_skip,s=this.should_remove,i=this.replacement;this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.enter.call(this.context,t,e,l,r),this.replacement&&(t=this.replacement,this.replace(e,l,r,t)),this.should_remove&&this.remove(e,l,r);const n=this.should_skip,a=this.should_remove;if(this.should_skip=h,this.should_remove=s,this.replacement=i,n)return t;if(a)return null}for(const h in t){const s=t[h];if(typeof s=="object")if(Array.isArray(s))for(let i=0;i<s.length;i+=1)s[i]!==null&&typeof s[i].type=="string"&&(this.visit(s[i],t,h,i)||i--);else s!==null&&typeof s.type=="string"&&this.visit(s,t,h,null)}if(this.leave){const h=this.replacement,s=this.should_remove;this.replacement=null,this.should_remove=!1,this.leave.call(this.context,t,e,l,r),this.replacement&&(t=this.replacement,this.replace(e,l,r,t)),this.should_remove&&this.remove(e,l,r);const i=this.should_remove;if(this.replacement=h,this.should_remove=s,i)return null}}return t}}class p extends u{constructor(t,e){super(),this.enter=t,this.leave=e}async visit(t,e,l,r){if(t){if(this.enter){const h=this.should_skip,s=this.should_remove,i=this.replacement;this.should_skip=!1,this.should_remove=!1,this.replacement=null,await this.enter.call(this.context,t,e,l,r),this.replacement&&(t=this.replacement,this.replace(e,l,r,t)),this.should_remove&&this.remove(e,l,r);const n=this.should_skip,a=this.should_remove;if(this.should_skip=h,this.should_remove=s,this.replacement=i,n)return t;if(a)return null}for(const h in t){const s=t[h];if(typeof s=="object")if(Array.isArray(s))for(let i=0;i<s.length;i+=1)s[i]!==null&&typeof s[i].type=="string"&&(await this.visit(s[i],t,h,i)||i--);else s!==null&&typeof s.type=="string"&&await this.visit(s,t,h,null)}if(this.leave){const h=this.replacement,s=this.should_remove;this.replacement=null,this.should_remove=!1,await this.leave.call(this.context,t,e,l,r),this.replacement&&(t=this.replacement,this.replace(e,l,r,t)),this.should_remove&&this.remove(e,l,r);const i=this.should_remove;if(this.replacement=h,this.should_remove=s,i)return null}}return t}}function m(o,{enter:t,leave:e}){return new c(t,e).visit(o,null)}async function v(o,{enter:t,leave:e}){return await new p(t,e).visit(o,null)}export{v as asyncWalk,m as walk};
