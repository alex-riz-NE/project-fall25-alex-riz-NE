function F(e,t){const r=Object.create(SyntaxError.prototype),o=new Error;return Object.assign(r,{name:e,message:t,get stack(){return(o.stack||"").replace(/^(.+\n){1,3}/,`${e}: ${t}
`)}})}function A(e,t,r){return Object.assign(F("SyntaxError",e),{input:t,offset:r,rawMessage:e,message:e+`
  `+t+`
--`+new Array((r||t.length)+1).join("-")+"^"})}function R(e){return e}function B(e){const{min:t,max:r,comma:o}=e;return t===0&&r===0?o?"#?":"*":t===0&&r===1?"?":t===1&&r===0?o?"#":"+":t===1&&r===1?"":(o?"#":"")+(t===r?"{"+t+"}":"{"+t+","+(r!==0?r:"")+"}")}function Z(e){switch(e.type){case"Range":return" ["+(e.min===null?"-\u221E":e.min)+","+(e.max===null?"\u221E":e.max)+"]";default:throw new Error("Unknown node type `"+e.type+"`")}}function q(e,t,r,o){const n=e.combinator===" "||o?e.combinator:" "+e.combinator+" ",a=e.terms.map(c=>y(c,t,r,o)).join(n);return e.explicit||r?(o||a[0]===","?"[":"[ ")+a+(o?"]":" ]"):a}function y(e,t,r,o){let n;switch(e.type){case"Group":n=q(e,t,r,o)+(e.disallowEmpty?"!":"");break;case"Multiplier":return y(e.term,t,r,o)+t(B(e),e);case"Type":n="<"+e.name+(e.opts?t(Z(e.opts),e.opts):"")+">";break;case"Property":n="<'"+e.name+"'>";break;case"Keyword":n=e.name;break;case"AtKeyword":n="@"+e.name;break;case"Function":n=e.name+"(";break;case"String":case"Token":n=e.value;break;case"Comma":n=",";break;default:throw new Error("Unknown node type `"+e.type+"`")}return t(n,e)}function z(e,t){let r=R,o=!1,n=!1;return typeof t=="function"?r=t:t&&(o=!!t.forceBraces,n=!!t.compact,typeof t.decorate=="function"&&(r=t.decorate)),y(e,r,o,n)}const D=9,H=10,I=12,J=13,L=32;let Q=class{constructor(t){this.str=t,this.pos=0}charCodeAt(t){return t<this.str.length?this.str.charCodeAt(t):0}charCode(){return this.charCodeAt(this.pos)}nextCharCode(){return this.charCodeAt(this.pos+1)}nextNonWsCode(t){return this.charCodeAt(this.findWsEnd(t))}findWsEnd(t){for(;t<this.str.length;t++){const r=this.str.charCodeAt(t);if(r!==J&&r!==H&&r!==I&&r!==L&&r!==D)break}return t}substringToPos(t){return this.str.substring(this.pos,this.pos=t)}eat(t){this.charCode()!==t&&this.error("Expect `"+String.fromCharCode(t)+"`"),this.pos++}peek(){return this.pos<this.str.length?this.str.charAt(this.pos++):""}error(t){throw new A(t,this.str,this.pos)}};const V=9,X=10,Y=12,_=13,ee=32,$=33,C=35,T=38,s=39,v=40,te=41,S=42,b=43,k=44,P=45,w=60,U=62,x=63,re=64,h=91,g=93,m=123,j=124,K=125,N=8734,p=new Uint8Array(128).map((e,t)=>/[a-zA-Z0-9\-]/.test(String.fromCharCode(t))?1:0),G={" ":1,"&&":2,"||":3,"|":4};function f(e){return e.substringToPos(e.findWsEnd(e.pos))}function i(e){let t=e.pos;for(;t<e.str.length;t++){const r=e.str.charCodeAt(t);if(r>=128||p[r]===0)break}return e.pos===t&&e.error("Expect a keyword"),e.substringToPos(t)}function d(e){let t=e.pos;for(;t<e.str.length;t++){const r=e.str.charCodeAt(t);if(r<48||r>57)break}return e.pos===t&&e.error("Expect a number"),e.substringToPos(t)}function ne(e){const t=e.str.indexOf("'",e.pos+1);return t===-1&&(e.pos=e.str.length,e.error("Expect an apostrophe")),e.substringToPos(t+1)}function W(e){let t=null,r=null;return e.eat(m),t=d(e),e.charCode()===k?(e.pos++,e.charCode()!==K&&(r=d(e))):r=t,e.eat(K),{min:Number(t),max:r?Number(r):0}}function oe(e){let t=null,r=!1;switch(e.charCode()){case S:e.pos++,t={min:0,max:0};break;case b:e.pos++,t={min:1,max:0};break;case x:e.pos++,t={min:0,max:1};break;case C:e.pos++,r=!0,e.charCode()===m?t=W(e):e.charCode()===x?(e.pos++,t={min:0,max:0}):t={min:1,max:0};break;case m:t=W(e);break;default:return null}return{type:"Multiplier",comma:r,min:t.min,max:t.max,term:null}}function u(e,t){const r=oe(e);return r!==null?(r.term=t,e.charCode()===C&&e.charCodeAt(e.pos-1)===b?u(e,r):r):t}function E(e){const t=e.peek();return t===""?null:{type:"Token",value:t}}function ae(e){let t;return e.eat(w),e.eat(s),t=i(e),e.eat(s),e.eat(U),u(e,{type:"Property",name:t})}function ce(e){let t=null,r=null,o=1;return e.eat(h),e.charCode()===P&&(e.peek(),o=-1),o==-1&&e.charCode()===N?e.peek():(t=o*Number(d(e)),p[e.charCode()]!==0&&(t+=i(e))),f(e),e.eat(k),f(e),e.charCode()===N?e.peek():(o=1,e.charCode()===P&&(e.peek(),o=-1),r=o*Number(d(e)),p[e.charCode()]!==0&&(r+=i(e))),e.eat(g),{type:"Range",min:t,max:r}}function ie(e){let t,r=null;return e.eat(w),t=i(e),e.charCode()===v&&e.nextCharCode()===te&&(e.pos+=2,t+="()"),e.charCodeAt(e.findWsEnd(e.pos))===h&&(f(e),r=ce(e)),e.eat(U),u(e,{type:"Type",name:t,opts:r})}function ue(e){const t=i(e);return e.charCode()===v?(e.pos++,{type:"Function",name:t}):u(e,{type:"Keyword",name:t})}function pe(e,t){function r(n,a){return{type:"Group",terms:n,combinator:a,disallowEmpty:!1,explicit:!1}}let o;for(t=Object.keys(t).sort((n,a)=>G[n]-G[a]);t.length>0;){o=t.shift();let n=0,a=0;for(;n<e.length;n++){const c=e[n];c.type==="Combinator"&&(c.value===o?(a===-1&&(a=n-1),e.splice(n,1),n--):(a!==-1&&n-a>1&&(e.splice(a,n-a,r(e.slice(a,n),o)),n=a+1),a=-1))}a!==-1&&t.length&&e.splice(a,n-a,r(e.slice(a,n),o))}return o}function M(e){const t=[],r={};let o,n=null,a=e.pos;for(;o=se(e);)o.type!=="Spaces"&&(o.type==="Combinator"?((n===null||n.type==="Combinator")&&(e.pos=a,e.error("Unexpected combinator")),r[o.value]=!0):n!==null&&n.type!=="Combinator"&&(r[" "]=!0,t.push({type:"Combinator",value:" "})),t.push(o),n=o,a=e.pos);return n!==null&&n.type==="Combinator"&&(e.pos-=a,e.error("Unexpected combinator")),{type:"Group",terms:t,combinator:pe(t,r)||" ",disallowEmpty:!1,explicit:!1}}function le(e){let t;return e.eat(h),t=M(e),e.eat(g),t.explicit=!0,e.charCode()===$&&(e.pos++,t.disallowEmpty=!0),t}function se(e){let t=e.charCode();if(t<128&&p[t]===1)return ue(e);switch(t){case g:break;case h:return u(e,le(e));case w:return e.nextCharCode()===s?ae(e):ie(e);case j:return{type:"Combinator",value:e.substringToPos(e.pos+(e.nextCharCode()===j?2:1))};case T:return e.pos++,e.eat(T),{type:"Combinator",value:"&&"};case k:return e.pos++,{type:"Comma"};case s:return u(e,{type:"String",value:ne(e)});case ee:case V:case X:case _:case Y:return{type:"Spaces",value:f(e)};case re:return t=e.nextCharCode(),t<128&&p[t]===1?(e.pos++,{type:"AtKeyword",name:i(e)}):E(e);case S:case b:case x:case C:case $:break;case m:if(t=e.nextCharCode(),t<48||t>57)return E(e);break;default:return E(e)}}function he(e){const t=new Q(e),r=M(t);return t.pos!==e.length&&t.error("Unexpected input"),r.terms.length===1&&r.terms[0].type==="Group"?r.terms[0]:r}const l=function(){};function O(e){return typeof e=="function"?e:l}function me(e,t,r){function o(c){switch(n.call(r,c),c.type){case"Group":c.terms.forEach(o);break;case"Multiplier":o(c.term);break;case"Type":case"Property":case"Keyword":case"AtKeyword":case"Function":case"String":case"Token":case"Comma":break;default:throw new Error("Unknown type: "+c.type)}a.call(r,c)}let n=l,a=l;if(typeof t=="function"?n=t:t&&(n=O(t.enter),a=O(t.leave)),n===l&&a===l)throw new Error("Neither `enter` nor `leave` walker handler is set or both aren't a function");o(e)}export{A as SyntaxError,z as generate,he as parse,me as walk};
