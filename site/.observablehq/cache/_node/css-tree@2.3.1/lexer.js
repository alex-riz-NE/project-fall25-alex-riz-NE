function je(t,e){const n=Object.create(SyntaxError.prototype),a=new Error;return Object.assign(n,{name:t,message:e,get stack(){return(a.stack||"").replace(/^(.+\n){1,3}/,`${t}: ${e}
`)}})}function yn(t){return t}function mn(t){const{min:e,max:n,comma:a}=t;return e===0&&n===0?a?"#?":"*":e===0&&n===1?"?":e===1&&n===0?a?"#":"+":e===1&&n===1?"":(a?"#":"")+(e===n?"{"+e+"}":"{"+e+","+(n!==0?n:"")+"}")}function gn(t){switch(t.type){case"Range":return" ["+(t.min===null?"-\u221E":t.min)+","+(t.max===null?"\u221E":t.max)+"]";default:throw new Error("Unknown node type `"+t.type+"`")}}function kn(t,e,n,a){const r=t.combinator===" "||a?t.combinator:" "+t.combinator+" ",s=t.terms.map(o=>Le(o,e,n,a)).join(r);return t.explicit||n?(a||s[0]===","?"[":"[ ")+s+(a?"]":" ]"):s}function Le(t,e,n,a){let r;switch(t.type){case"Group":r=kn(t,e,n,a)+(t.disallowEmpty?"!":"");break;case"Multiplier":return Le(t.term,e,n,a)+e(mn(t),t);case"Type":r="<"+t.name+(t.opts?e(gn(t.opts),t.opts):"")+">";break;case"Property":r="<'"+t.name+"'>";break;case"Keyword":r=t.name;break;case"AtKeyword":r="@"+t.name;break;case"Function":r=t.name+"(";break;case"String":case"Token":r=t.value;break;case"Comma":r=",";break;default:throw new Error("Unknown node type `"+t.type+"`")}return e(r,t)}function Ne(t,e){let n=yn,a=!1,r=!1;return typeof e=="function"?n=e:e&&(a=!!e.forceBraces,r=!!e.compact,typeof e.decorate=="function"&&(n=e.decorate)),Le(t,n,a,r)}const bt={offset:0,line:1,column:1};function bn(t,e){const n=t.tokens,a=t.longestMatch,r=a<n.length&&n[a].node||null,s=r!==e?r:null;let o=0,c=0,h=0,l="",u,i;for(let m=0;m<n.length;m++){const g=n[m].value;m===a&&(c=g.length,o=l.length),s!==null&&n[m].node===s&&(m<=a?h++:h=0),l+=g}return a===n.length||h>1?(u=ce(s||e,"end")||te(bt,l),i=te(u)):(u=ce(s,"start")||te(ce(e,"start")||bt,l.slice(0,o)),i=ce(s,"end")||te(u,l.substr(o,c))),{css:l,mismatchOffset:o,mismatchLength:c,start:u,end:i}}function ce(t,e){const n=t&&t.loc&&t.loc[e];return n?"line"in n?te(n):n:null}function te({offset:t,line:e,column:n},a){const r={offset:t,line:e,column:n};if(a){const s=a.split(/\n|\r\n?|\f/);r.offset+=a.length,r.line+=s.length-1,r.column=s.length===1?r.column+a.length:s.pop().length+1}return r}const ne=function(t,e){const n=je("SyntaxReferenceError",t+(e?" `"+e+"`":""));return n.reference=e,n},vn=function(t,e,n,a){const r=je("SyntaxMatchError",t),{css:s,mismatchOffset:o,mismatchLength:c,start:h,end:l}=bn(a,n);return r.rawMessage=t,r.syntax=e?Ne(e):"<generic>",r.css=s,r.mismatchOffset=o,r.mismatchLength=c,r.message=t+`
  syntax: `+r.syntax+`
   value: `+(s||"<empty string>")+`
  --------`+new Array(r.mismatchOffset+1).join("-")+"^",Object.assign(r,h),r.loc={source:n&&n.loc&&n.loc.source||"<unknown>",start:h,end:l},r},he=new Map,_=new Map,pe=45,Ke=xn,vt=$n;function xt(t,e){return e=e||0,t.length-e>=2&&t.charCodeAt(e)===pe&&t.charCodeAt(e+1)===pe}function $t(t,e){if(e=e||0,t.length-e>=3&&t.charCodeAt(e)===pe&&t.charCodeAt(e+1)!==pe){const n=t.indexOf("-",e+2);if(n!==-1)return t.substring(e,n+1)}return""}function xn(t){if(he.has(t))return he.get(t);const e=t.toLowerCase();let n=he.get(e);if(n===void 0){const a=xt(e,0),r=a?"":$t(e,0);n=Object.freeze({basename:e.substr(r.length),name:e,prefix:r,vendor:r,custom:a})}return he.set(t,n),n}function $n(t){if(_.has(t))return _.get(t);let e=t,n=t[0];n==="/"?n=t[1]==="/"?"//":"/":n!=="_"&&n!=="*"&&n!=="$"&&n!=="#"&&n!=="+"&&n!=="&"&&(n="");const a=xt(e,n.length);if(!a&&(e=e.toLowerCase(),_.has(e))){const c=_.get(e);return _.set(t,c),c}const r=a?"":$t(e,n.length),s=e.substr(0,n.length+r.length),o=Object.freeze({basename:e.substr(s.length),name:e.substr(n.length),hack:n,vendor:r,prefix:s,custom:a});return _.set(t,o),o}const wt=["initial","inherit","unset","revert","revert-layer"],O=1,j=2,Ct=3,fe=4,Ie=5,de=6,At=7,V=8,w=9,L=10,Ue=11,J=12,ye=13,Ot=14,Et=15,St=16,Fe=17,me=18,B=19,z=20,G=21,I=22,q=23,R=24,Be=25;function C(t){return t>=48&&t<=57}function ge(t){return C(t)||t>=65&&t<=70||t>=97&&t<=102}function ze(t){return t>=65&&t<=90}function wn(t){return t>=97&&t<=122}function Cn(t){return ze(t)||wn(t)}function An(t){return t>=128}function ke(t){return Cn(t)||An(t)||t===95}function Pt(t){return ke(t)||C(t)||t===45}function On(t){return t>=0&&t<=8||t===11||t>=14&&t<=31||t===127}function be(t){return t===10||t===13||t===12}function Ge(t){return be(t)||t===32||t===9}function U(t,e){return!(t!==92||be(e)||e===0)}function ve(t,e,n){return t===45?ke(e)||e===45||U(e,n):ke(t)?!0:t===92?U(t,e):!1}function qe(t,e,n){return t===43||t===45?C(e)?2:e===46&&C(n)?3:0:t===46?C(e)?2:0:C(t)?1:0}function En(t){return t===65279||t===65534?1:0}const Re=new Array(128),Sn=128,xe=130,Mt=131,We=132,Tt=133;for(let t=0;t<Re.length;t++)Re[t]=Ge(t)&&xe||C(t)&&Mt||ke(t)&&We||On(t)&&Tt||t||Sn;function _e(t){return t<128?Re[t]:We}function Z(t,e){return e<t.length?t.charCodeAt(e):0}function Ve(t,e,n){return n===13&&Z(t,e+1)===10?2:1}function re(t,e,n){let a=t.charCodeAt(e);return ze(a)&&(a=a|32),a===n}function Dt(t,e,n,a){if(n-e!==a.length||e<0||n>t.length)return!1;for(let r=e;r<n;r++){const s=a.charCodeAt(r-e);let o=t.charCodeAt(r);if(ze(o)&&(o=o|32),o!==s)return!1}return!0}function $e(t,e){for(;e<t.length&&Ge(t.charCodeAt(e));e++);return e}function Je(t,e){for(;e<t.length&&C(t.charCodeAt(e));e++);return e}function we(t,e){if(e+=2,ge(Z(t,e-1))){for(const a=Math.min(t.length,e+5);e<a&&ge(Z(t,e));e++);const n=Z(t,e);Ge(n)&&(e+=Ve(t,e,n))}return e}function Ce(t,e){for(;e<t.length;e++){const n=t.charCodeAt(e);if(!Pt(n)){if(U(n,Z(t,e+1))){e=we(t,e)-1;continue}break}}return e}function Ze(t,e){let n=t.charCodeAt(e);if((n===43||n===45)&&(n=t.charCodeAt(e+=1)),C(n)&&(e=Je(t,e+1),n=t.charCodeAt(e)),n===46&&C(t.charCodeAt(e+1))&&(e+=2,e=Je(t,e)),re(t,e,101)){let a=0;n=t.charCodeAt(e+1),(n===45||n===43)&&(a=1,n=t.charCodeAt(e+2)),C(n)&&(e=Je(t,e+1+a+1))}return e}function He(t,e){for(;e<t.length;e++){const n=t.charCodeAt(e);if(n===41){e++;break}U(n,Z(t,e+1))&&(e=we(t,e))}return e}function Pn(t,e){function n(i){return i<c?t.charCodeAt(i):0}function a(){if(l=Ze(t,l),ve(n(l),n(l+1),n(l+2))){u=J,l=Ce(t,l);return}if(n(l)===37){u=Ue,l++;return}u=L}function r(){const i=l;if(l=Ce(t,l),Dt(t,i,l,"url")&&n(l)===40){if(l=$e(t,l+1),n(l)===34||n(l)===39){u=j,l=i+4;return}o();return}if(n(l)===40){u=j,l++;return}u=O}function s(i){for(i||(i=n(l++)),u=Ie;l<t.length;l++){const m=t.charCodeAt(l);switch(_e(m)){case i:l++;return;case xe:if(be(m)){l+=Ve(t,l,m),u=de;return}break;case 92:if(l===t.length-1)break;const g=n(l+1);be(g)?l+=Ve(t,l+1,g):U(m,g)&&(l=we(t,l)-1);break}}}function o(){for(u=At,l=$e(t,l);l<t.length;l++){const i=t.charCodeAt(l);switch(_e(i)){case 41:l++;return;case xe:if(l=$e(t,l),n(l)===41||l>=t.length){l<t.length&&l++;return}l=He(t,l),u=V;return;case 34:case 39:case 40:case Tt:l=He(t,l),u=V;return;case 92:if(U(i,n(l+1))){l=we(t,l)-1;break}l=He(t,l),u=V;return}}}t=String(t||"");const c=t.length;let h=En(n(0)),l=h,u;for(;l<c;){const i=t.charCodeAt(l);switch(_e(i)){case xe:u=ye,l=$e(t,l+1);break;case 34:s();break;case 35:Pt(n(l+1))||U(n(l+1),n(l+2))?(u=fe,l=Ce(t,l+1)):(u=w,l++);break;case 39:s();break;case 40:u=G,l++;break;case 41:u=I,l++;break;case 43:qe(i,n(l+1),n(l+2))?a():(u=w,l++);break;case 44:u=me,l++;break;case 45:qe(i,n(l+1),n(l+2))?a():n(l+1)===45&&n(l+2)===62?(u=Et,l=l+3):ve(i,n(l+1),n(l+2))?r():(u=w,l++);break;case 46:qe(i,n(l+1),n(l+2))?a():(u=w,l++);break;case 47:n(l+1)===42?(u=Be,l=t.indexOf("*/",l+2),l=l===-1?t.length:l+2):(u=w,l++);break;case 58:u=St,l++;break;case 59:u=Fe,l++;break;case 60:n(l+1)===33&&n(l+2)===45&&n(l+3)===45?(u=Ot,l=l+4):(u=w,l++);break;case 64:ve(n(l+1),n(l+2),n(l+3))?(u=Ct,l=Ce(t,l+1)):(u=w,l++);break;case 91:u=B,l++;break;case 92:U(i,n(l+1))?r():(u=w,l++);break;case 93:u=z,l++;break;case 123:u=q,l++;break;case 125:u=R,l++;break;case Mt:a();break;case We:r();break;default:u=w,l++}e(u,h,h=l)}}const ae=43,T=45,Ye=110,H=!0,Mn=!1;function Qe(t,e){return t!==null&&t.type===w&&t.value.charCodeAt(0)===e}function se(t,e,n){for(;t!==null&&(t.type===ye||t.type===Be);)t=n(++e);return e}function F(t,e,n,a){if(!t)return 0;const r=t.value.charCodeAt(e);if(r===ae||r===T){if(n)return 0;e++}for(;e<t.value.length;e++)if(!C(t.value.charCodeAt(e)))return 0;return a+1}function Xe(t,e,n){let a=!1,r=se(t,e,n);if(t=n(r),t===null)return e;if(t.type!==L)if(Qe(t,ae)||Qe(t,T)){if(a=!0,r=se(n(++r),r,n),t=n(r),t===null||t.type!==L)return 0}else return e;if(!a){const s=t.value.charCodeAt(0);if(s!==ae&&s!==T)return 0}return F(t,a?0:1,a,r)}function Tn(t,e){let n=0;if(!t)return 0;if(t.type===L)return F(t,0,Mn,n);if(t.type===O&&t.value.charCodeAt(0)===T){if(!re(t.value,1,Ye))return 0;switch(t.value.length){case 2:return Xe(e(++n),n,e);case 3:return t.value.charCodeAt(2)!==T?0:(n=se(e(++n),n,e),t=e(n),F(t,0,H,n));default:return t.value.charCodeAt(2)!==T?0:F(t,3,H,n)}}else if(t.type===O||Qe(t,ae)&&e(n+1).type===O){if(t.type!==O&&(t=e(++n)),t===null||!re(t.value,0,Ye))return 0;switch(t.value.length){case 1:return Xe(e(++n),n,e);case 2:return t.value.charCodeAt(1)!==T?0:(n=se(e(++n),n,e),t=e(n),F(t,0,H,n));default:return t.value.charCodeAt(1)!==T?0:F(t,2,H,n)}}else if(t.type===J){let a=t.value.charCodeAt(0),r=a===ae||a===T?1:0,s=r;for(;s<t.value.length&&C(t.value.charCodeAt(s));s++);return s===r||!re(t.value,s,Ye)?0:s+1===t.value.length?Xe(e(++n),n,e):t.value.charCodeAt(s+1)!==T?0:s+2===t.value.length?(n=se(e(++n),n,e),t=e(n),F(t,0,H,n)):F(t,s+2,H,n)}return 0}const Dn=43,jt=45,Lt=63,jn=117;function et(t,e){return t!==null&&t.type===w&&t.value.charCodeAt(0)===e}function Ln(t,e){return t.value.charCodeAt(0)===e}function le(t,e,n){let a=0;for(let r=e;r<t.value.length;r++){const s=t.value.charCodeAt(r);if(s===jt&&n&&a!==0)return le(t,e+a+1,!1),6;if(!ge(s)||++a>6)return 0}return a}function Ae(t,e,n){if(!t)return 0;for(;et(n(e),Lt);){if(++t>6)return 0;e++}return e}function Nn(t,e){let n=0;if(t===null||t.type!==O||!re(t.value,0,jn)||(t=e(++n),t===null))return 0;if(et(t,Dn))return t=e(++n),t===null?0:t.type===O?Ae(le(t,0,!0),++n,e):et(t,Lt)?Ae(1,++n,e):0;if(t.type===L){const a=le(t,1,!0);return a===0?0:(t=e(++n),t===null?n:t.type===J||t.type===L?!Ln(t,jt)||!le(t,1,!1)?0:n+1:Ae(a,n,e))}return t.type===J?Ae(le(t,1,!0),++n,e):0}const Kn=["calc(","-moz-calc(","-webkit-calc("],tt=new Map([[j,I],[G,I],[B,z],[q,R]]);function P(t,e){return e<t.length?t.charCodeAt(e):0}function Nt(t,e){return Dt(t,0,t.length,e)}function Kt(t,e){for(let n=0;n<e.length;n++)if(Nt(t,e[n]))return!0;return!1}function It(t,e){return e!==t.length-2?!1:P(t,e)===92&&C(P(t,e+1))}function Oe(t,e,n){if(t&&t.type==="Range"){const a=Number(n!==void 0&&n!==e.length?e.substr(0,n):e);if(isNaN(a)||t.min!==null&&a<t.min&&typeof t.min!="string"||t.max!==null&&a>t.max&&typeof t.max!="string")return!0}return!1}function In(t,e){let n=0,a=[],r=0;e:do{switch(t.type){case R:case I:case z:if(t.type!==n)break e;if(n=a.pop(),a.length===0){r++;break e}break;case j:case G:case B:case q:a.push(n),n=tt.get(t.type);break}r++}while(t=e(r));return r}function E(t){return function(e,n,a){return e===null?0:e.type===j&&Kt(e.value,Kn)?In(e,n):t(e,n,a)}}function d(t){return function(e){return e===null||e.type!==t?0:1}}function Un(t){if(t===null||t.type!==O)return 0;const e=t.value.toLowerCase();return Kt(e,wt)||Nt(e,"default")?0:1}function Fn(t){return t===null||t.type!==O||P(t.value,0)!==45||P(t.value,1)!==45?0:1}function Bn(t){if(t===null||t.type!==fe)return 0;const e=t.value.length;if(e!==4&&e!==5&&e!==7&&e!==9)return 0;for(let n=1;n<e;n++)if(!ge(P(t.value,n)))return 0;return 1}function zn(t){return t===null||t.type!==fe||!ve(P(t.value,1),P(t.value,2),P(t.value,3))?0:1}function Gn(t,e){if(!t)return 0;let n=0,a=[],r=0;e:do{switch(t.type){case de:case V:break e;case R:case I:case z:if(t.type!==n)break e;n=a.pop();break;case Fe:if(n===0)break e;break;case w:if(n===0&&t.value==="!")break e;break;case j:case G:case B:case q:a.push(n),n=tt.get(t.type);break}r++}while(t=e(r));return r}function qn(t,e){if(!t)return 0;let n=0,a=[],r=0;e:do{switch(t.type){case de:case V:break e;case R:case I:case z:if(t.type!==n)break e;n=a.pop();break;case j:case G:case B:case q:a.push(n),n=tt.get(t.type);break}r++}while(t=e(r));return r}function N(t){return t&&(t=new Set(t)),function(e,n,a){if(e===null||e.type!==J)return 0;const r=Ze(e.value,0);if(t!==null){const s=e.value.indexOf("\\",r),o=s===-1||!It(e.value,s)?e.value.substr(r):e.value.substring(r,s);if(t.has(o.toLowerCase())===!1)return 0}return Oe(a,e.value,r)?0:1}}function Rn(t,e,n){return t===null||t.type!==Ue||Oe(n,t.value,t.value.length-1)?0:1}function Ut(t){return typeof t!="function"&&(t=function(){return 0}),function(e,n,a){return e!==null&&e.type===L&&Number(e.value)===0?1:t(e,n,a)}}function Wn(t,e,n){if(t===null)return 0;const a=Ze(t.value,0);return a!==t.value.length&&!It(t.value,a)||Oe(n,t.value,a)?0:1}function _n(t,e,n){if(t===null||t.type!==L)return 0;let a=P(t.value,0)===43||P(t.value,0)===45?1:0;for(;a<t.value.length;a++)if(!C(P(t.value,a)))return 0;return Oe(n,t.value,a)?0:1}const Vn={"ident-token":d(O),"function-token":d(j),"at-keyword-token":d(Ct),"hash-token":d(fe),"string-token":d(Ie),"bad-string-token":d(de),"url-token":d(At),"bad-url-token":d(V),"delim-token":d(w),"number-token":d(L),"percentage-token":d(Ue),"dimension-token":d(J),"whitespace-token":d(ye),"CDO-token":d(Ot),"CDC-token":d(Et),"colon-token":d(St),"semicolon-token":d(Fe),"comma-token":d(me),"[-token":d(B),"]-token":d(z),"(-token":d(G),")-token":d(I),"{-token":d(q),"}-token":d(R)},Jn={string:d(Ie),ident:d(O),percentage:E(Rn),zero:Ut(),number:E(Wn),integer:E(_n),"custom-ident":Un,"custom-property-name":Fn,"hex-color":Bn,"id-selector":zn,"an-plus-b":Tn,urange:Nn,"declaration-value":Gn,"any-value":qn};function Zn(t){const{angle:e,decibel:n,frequency:a,flex:r,length:s,resolution:o,semitones:c,time:h}=t||{};return{dimension:E(N(null)),angle:E(N(e)),decibel:E(N(n)),frequency:E(N(a)),flex:E(N(r)),length:E(Ut(N(s))),resolution:E(N(o)),semitones:E(N(c)),time:E(N(h))}}function Hn(t){return{...Vn,...Jn,...Zn(t)}}const Yn=["cm","mm","q","in","pt","pc","px","em","rem","ex","rex","cap","rcap","ch","rch","ic","ric","lh","rlh","vw","svw","lvw","dvw","vh","svh","lvh","dvh","vi","svi","lvi","dvi","vb","svb","lvb","dvb","vmin","svmin","lvmin","dvmin","vmax","svmax","lvmax","dvmax","cqw","cqh","cqi","cqb","cqmin","cqmax"],Qn=["deg","grad","rad","turn"],Xn=["s","ms"],er=["hz","khz"],tr=["dpi","dpcm","dppx","x"],nr=["fr"],rr=["db"],ar=["st"];var Ft=Object.freeze({__proto__:null,angle:Qn,decibel:rr,flex:nr,frequency:er,length:Yn,resolution:tr,semitones:ar,time:Xn});function sr(t,e,n){return Object.assign(je("SyntaxError",t),{input:e,offset:n,rawMessage:t,message:t+`
  `+e+`
--`+new Array((n||e.length)+1).join("-")+"^"})}const lr=9,or=10,ur=12,ir=13,cr=32;let hr=class{constructor(e){this.str=e,this.pos=0}charCodeAt(e){return e<this.str.length?this.str.charCodeAt(e):0}charCode(){return this.charCodeAt(this.pos)}nextCharCode(){return this.charCodeAt(this.pos+1)}nextNonWsCode(e){return this.charCodeAt(this.findWsEnd(e))}findWsEnd(e){for(;e<this.str.length;e++){const n=this.str.charCodeAt(e);if(n!==ir&&n!==or&&n!==ur&&n!==cr&&n!==lr)break}return e}substringToPos(e){return this.str.substring(this.pos,this.pos=e)}eat(e){this.charCode()!==e&&this.error("Expect `"+String.fromCharCode(e)+"`"),this.pos++}peek(){return this.pos<this.str.length?this.str.charAt(this.pos++):""}error(e){throw new sr(e,this.str,this.pos)}};const pr=9,fr=10,dr=12,yr=13,mr=32,Bt=33,nt=35,zt=38,Ee=39,Gt=40,gr=41,qt=42,rt=43,at=44,Rt=45,st=60,Wt=62,lt=63,kr=64,Se=91,ot=93,Pe=123,_t=124,Vt=125,Jt=8734,oe=new Uint8Array(128).map((t,e)=>/[a-zA-Z0-9\-]/.test(String.fromCharCode(e))?1:0),Zt={" ":1,"&&":2,"||":3,"|":4};function Me(t){return t.substringToPos(t.findWsEnd(t.pos))}function Y(t){let e=t.pos;for(;e<t.str.length;e++){const n=t.str.charCodeAt(e);if(n>=128||oe[n]===0)break}return t.pos===e&&t.error("Expect a keyword"),t.substringToPos(e)}function Te(t){let e=t.pos;for(;e<t.str.length;e++){const n=t.str.charCodeAt(e);if(n<48||n>57)break}return t.pos===e&&t.error("Expect a number"),t.substringToPos(e)}function br(t){const e=t.str.indexOf("'",t.pos+1);return e===-1&&(t.pos=t.str.length,t.error("Expect an apostrophe")),t.substringToPos(e+1)}function Ht(t){let e=null,n=null;return t.eat(Pe),e=Te(t),t.charCode()===at?(t.pos++,t.charCode()!==Vt&&(n=Te(t))):n=e,t.eat(Vt),{min:Number(e),max:n?Number(n):0}}function vr(t){let e=null,n=!1;switch(t.charCode()){case qt:t.pos++,e={min:0,max:0};break;case rt:t.pos++,e={min:1,max:0};break;case lt:t.pos++,e={min:0,max:1};break;case nt:t.pos++,n=!0,t.charCode()===Pe?e=Ht(t):t.charCode()===lt?(t.pos++,e={min:0,max:0}):e={min:1,max:0};break;case Pe:e=Ht(t);break;default:return null}return{type:"Multiplier",comma:n,min:e.min,max:e.max,term:null}}function Q(t,e){const n=vr(t);return n!==null?(n.term=e,t.charCode()===nt&&t.charCodeAt(t.pos-1)===rt?Q(t,n):n):e}function ut(t){const e=t.peek();return e===""?null:{type:"Token",value:e}}function xr(t){let e;return t.eat(st),t.eat(Ee),e=Y(t),t.eat(Ee),t.eat(Wt),Q(t,{type:"Property",name:e})}function $r(t){let e=null,n=null,a=1;return t.eat(Se),t.charCode()===Rt&&(t.peek(),a=-1),a==-1&&t.charCode()===Jt?t.peek():(e=a*Number(Te(t)),oe[t.charCode()]!==0&&(e+=Y(t))),Me(t),t.eat(at),Me(t),t.charCode()===Jt?t.peek():(a=1,t.charCode()===Rt&&(t.peek(),a=-1),n=a*Number(Te(t)),oe[t.charCode()]!==0&&(n+=Y(t))),t.eat(ot),{type:"Range",min:e,max:n}}function wr(t){let e,n=null;return t.eat(st),e=Y(t),t.charCode()===Gt&&t.nextCharCode()===gr&&(t.pos+=2,e+="()"),t.charCodeAt(t.findWsEnd(t.pos))===Se&&(Me(t),n=$r(t)),t.eat(Wt),Q(t,{type:"Type",name:e,opts:n})}function Cr(t){const e=Y(t);return t.charCode()===Gt?(t.pos++,{type:"Function",name:e}):Q(t,{type:"Keyword",name:e})}function Ar(t,e){function n(r,s){return{type:"Group",terms:r,combinator:s,disallowEmpty:!1,explicit:!1}}let a;for(e=Object.keys(e).sort((r,s)=>Zt[r]-Zt[s]);e.length>0;){a=e.shift();let r=0,s=0;for(;r<t.length;r++){const o=t[r];o.type==="Combinator"&&(o.value===a?(s===-1&&(s=r-1),t.splice(r,1),r--):(s!==-1&&r-s>1&&(t.splice(s,r-s,n(t.slice(s,r),a)),r=s+1),s=-1))}s!==-1&&e.length&&t.splice(s,r-s,n(t.slice(s,r),a))}return a}function Yt(t){const e=[],n={};let a,r=null,s=t.pos;for(;a=Er(t);)a.type!=="Spaces"&&(a.type==="Combinator"?((r===null||r.type==="Combinator")&&(t.pos=s,t.error("Unexpected combinator")),n[a.value]=!0):r!==null&&r.type!=="Combinator"&&(n[" "]=!0,e.push({type:"Combinator",value:" "})),e.push(a),r=a,s=t.pos);return r!==null&&r.type==="Combinator"&&(t.pos-=s,t.error("Unexpected combinator")),{type:"Group",terms:e,combinator:Ar(e,n)||" ",disallowEmpty:!1,explicit:!1}}function Or(t){let e;return t.eat(Se),e=Yt(t),t.eat(ot),e.explicit=!0,t.charCode()===Bt&&(t.pos++,e.disallowEmpty=!0),e}function Er(t){let e=t.charCode();if(e<128&&oe[e]===1)return Cr(t);switch(e){case ot:break;case Se:return Q(t,Or(t));case st:return t.nextCharCode()===Ee?xr(t):wr(t);case _t:return{type:"Combinator",value:t.substringToPos(t.pos+(t.nextCharCode()===_t?2:1))};case zt:return t.pos++,t.eat(zt),{type:"Combinator",value:"&&"};case at:return t.pos++,{type:"Comma"};case Ee:return Q(t,{type:"String",value:br(t)});case mr:case pr:case fr:case yr:case dr:return{type:"Spaces",value:Me(t)};case kr:return e=t.nextCharCode(),e<128&&oe[e]===1?(t.pos++,{type:"AtKeyword",name:Y(t)}):ut(t);case qt:case rt:case lt:case nt:case Bt:break;case Pe:if(e=t.nextCharCode(),e<48||e>57)return ut(t);break;default:return ut(t)}}function Qt(t){const e=new hr(t),n=Yt(e);return e.pos!==t.length&&e.error("Unexpected input"),n.terms.length===1&&n.terms[0].type==="Group"?n.terms[0]:n}const ue=function(){};function Xt(t){return typeof t=="function"?t:ue}function Sr(t,e,n){function a(o){switch(r.call(n,o),o.type){case"Group":o.terms.forEach(a);break;case"Multiplier":a(o.term);break;case"Type":case"Property":case"Keyword":case"AtKeyword":case"Function":case"String":case"Token":case"Comma":break;default:throw new Error("Unknown type: "+o.type)}s.call(n,o)}let r=ue,s=ue;if(typeof e=="function"?r=e:e&&(r=Xt(e.enter),s=Xt(e.leave)),r===ue&&s===ue)throw new Error("Neither `enter` nor `leave` walker handler is set or both aren't a function");a(t)}const Pr={decorator(t){const e=[];let n=null;return{...t,node(a){const r=n;n=a,t.node.call(this,a),n=r},emit(a,r,s){e.push({type:r,value:a,node:s?null:n})},result(){return e}}}};function Mr(t){const e=[];return Pn(t,(n,a,r)=>e.push({type:n,value:t.slice(a,r),node:null})),e}function Tr(t,e){return typeof t=="string"?Mr(t):e.generate(t,Pr)}const p={type:"Match"},f={type:"Mismatch"},it={type:"DisallowEmpty"},Dr=40,jr=41;function x(t,e,n){return e===p&&n===f||t===p&&e===p&&n===p?t:(t.type==="If"&&t.else===f&&e===p&&(e=t.then,t=t.match),{type:"If",match:t,then:e,else:n})}function en(t){return t.length>2&&t.charCodeAt(t.length-2)===Dr&&t.charCodeAt(t.length-1)===jr}function tn(t){return t.type==="Keyword"||t.type==="AtKeyword"||t.type==="Function"||t.type==="Type"&&en(t.name)}function ct(t,e,n){switch(t){case" ":{let a=p;for(let r=e.length-1;r>=0;r--){const s=e[r];a=x(s,a,f)}return a}case"|":{let a=f,r=null;for(let s=e.length-1;s>=0;s--){let o=e[s];if(tn(o)&&(r===null&&s>0&&tn(e[s-1])&&(r=Object.create(null),a=x({type:"Enum",map:r},p,a)),r!==null)){const c=(en(o.name)?o.name.slice(0,-1):o.name).toLowerCase();if(!(c in r)){r[c]=o;continue}}r=null,a=x(o,p,a)}return a}case"&&":{if(e.length>5)return{type:"MatchOnce",terms:e,all:!0};let a=f;for(let r=e.length-1;r>=0;r--){const s=e[r];let o;e.length>1?o=ct(t,e.filter(function(c){return c!==s}),!1):o=p,a=x(s,o,a)}return a}case"||":{if(e.length>5)return{type:"MatchOnce",terms:e,all:!1};let a=n?p:f;for(let r=e.length-1;r>=0;r--){const s=e[r];let o;e.length>1?o=ct(t,e.filter(function(c){return c!==s}),!0):o=p,a=x(s,o,a)}return a}}}function Lr(t){let e=p,n=ht(t.term);if(t.max===0)n=x(n,it,f),e=x(n,null,f),e.then=x(p,p,e),t.comma&&(e.then.else=x({type:"Comma",syntax:t},e,f));else for(let a=t.min||1;a<=t.max;a++)t.comma&&e!==p&&(e=x({type:"Comma",syntax:t},e,f)),e=x(n,x(p,p,e),f);if(t.min===0)e=x(p,p,e);else for(let a=0;a<t.min-1;a++)t.comma&&e!==p&&(e=x({type:"Comma",syntax:t},e,f)),e=x(n,e,f);return e}function ht(t){if(typeof t=="function")return{type:"Generic",fn:t};switch(t.type){case"Group":{let e=ct(t.combinator,t.terms.map(ht),!1);return t.disallowEmpty&&(e=x(e,it,f)),e}case"Multiplier":return Lr(t);case"Type":case"Property":return{type:t.type,name:t.name,syntax:t};case"Keyword":return{type:t.type,name:t.name.toLowerCase(),syntax:t};case"AtKeyword":return{type:t.type,name:"@"+t.name.toLowerCase(),syntax:t};case"Function":return{type:t.type,name:t.name.toLowerCase()+"(",syntax:t};case"String":return t.value.length===3?{type:"Token",value:t.value.charAt(1),syntax:t}:{type:t.type,value:t.value.substr(1,t.value.length-2).replace(/\\'/g,"'"),syntax:t};case"Token":return{type:t.type,value:t.value,syntax:t};case"Comma":return{type:t.type,syntax:t};default:throw new Error("Unknown node type:",t.type)}}function pt(t,e){return typeof t=="string"&&(t=Qt(t)),{type:"MatchGraph",match:ht(t),syntax:e||null,source:t}}const{hasOwnProperty:nn}=Object.prototype,Nr=0,Kr=1,ft=2,rn=3,an="Match",Ir="Mismatch",Ur="Maximum iteration number exceeded (please fill an issue on https://github.com/csstree/csstree/issues)",sn=15e3;function Fr(t){let e=null,n=null,a=t;for(;a!==null;)n=a.prev,a.prev=e,e=a,a=n;return e}function dt(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){const a=e.charCodeAt(n);let r=t.charCodeAt(n);if(r>=65&&r<=90&&(r=r|32),r!==a)return!1}return!0}function Br(t){return t.type!==w?!1:t.value!=="?"}function ln(t){return t===null?!0:t.type===me||t.type===j||t.type===G||t.type===B||t.type===q||Br(t)}function on(t){return t===null?!0:t.type===I||t.type===z||t.type===R||t.type===w&&t.value==="/"}function zr(t,e,n){function a(){do b++,y=b<t.length?t[b]:null;while(y!==null&&(y.type===ye||y.type===Be))}function r(S){const D=b+S;return D<t.length?t[D]:null}function s(S,D){return{nextState:S,matchStack:k,syntaxStack:i,thenStack:m,tokenIndex:b,prev:D}}function o(S){m={nextState:S,matchStack:k,syntaxStack:i,prev:m}}function c(S){g=s(S,g)}function h(){k={type:Kr,syntax:e.syntax,token:y,prev:k},a(),K=null,b>De&&(De=b)}function l(){i={syntax:e.syntax,opts:e.syntax.opts||i!==null&&i.opts||null,prev:i},k={type:ft,syntax:e.syntax,token:k.token,prev:k}}function u(){k.type===ft?k=k.prev:k={type:rn,syntax:i.syntax,token:k.token,prev:k},i=i.prev}let i=null,m=null,g=null,K=null,kt=0,W=null,y=null,b=-1,De=0,k={type:Nr,syntax:null,token:null,prev:null};for(a();W===null&&++kt<sn;)switch(e.type){case"Match":if(m===null){if(y!==null&&(b!==t.length-1||y.value!=="\\0"&&y.value!=="\\9")){e=f;break}W=an;break}if(e=m.nextState,e===it)if(m.matchStack===k){e=f;break}else e=p;for(;m.syntaxStack!==i;)u();m=m.prev;break;case"Mismatch":if(K!==null&&K!==!1)(g===null||b>g.tokenIndex)&&(g=K,K=!1);else if(g===null){W=Ir;break}e=g.nextState,m=g.thenStack,i=g.syntaxStack,k=g.matchStack,b=g.tokenIndex,y=b<t.length?t[b]:null,g=g.prev;break;case"MatchGraph":e=e.match;break;case"If":e.else!==f&&c(e.else),e.then!==p&&o(e.then),e=e.match;break;case"MatchOnce":e={type:"MatchOnceBuffer",syntax:e,index:0,mask:0};break;case"MatchOnceBuffer":{const v=e.syntax.terms;if(e.index===v.length){if(e.mask===0||e.syntax.all){e=f;break}e=p;break}if(e.mask===(1<<v.length)-1){e=p;break}for(;e.index<v.length;e.index++){const $=1<<e.index;if(!(e.mask&$)){c(e),o({type:"AddMatchOnce",syntax:e.syntax,mask:e.mask|$}),e=v[e.index++];break}}break}case"AddMatchOnce":e={type:"MatchOnceBuffer",syntax:e.syntax,index:0,mask:e.mask};break;case"Enum":if(y!==null){let v=y.value.toLowerCase();if(v.indexOf("\\")!==-1&&(v=v.replace(/\\[09].*$/,"")),nn.call(e.map,v)){e=e.map[v];break}}e=f;break;case"Generic":{const v=i!==null?i.opts:null,$=b+Math.floor(e.fn(y,r,v));if(!isNaN($)&&$>b){for(;b<$;)h();e=p}else e=f;break}case"Type":case"Property":{const v=e.type==="Type"?"types":"properties",$=nn.call(n,v)?n[v][e.name]:null;if(!$||!$.match)throw new Error("Bad syntax reference: "+(e.type==="Type"?"<"+e.name+">":"<'"+e.name+"'>"));if(K!==!1&&y!==null&&e.type==="Type"&&(e.name==="custom-ident"&&y.type===O||e.name==="length"&&y.value==="0")){K===null&&(K=s(e,g)),e=f;break}l(),e=$.match;break}case"Keyword":{const v=e.name;if(y!==null){let $=y.value;if($.indexOf("\\")!==-1&&($=$.replace(/\\[09].*$/,"")),dt($,v)){h(),e=p;break}}e=f;break}case"AtKeyword":case"Function":if(y!==null&&dt(y.value,e.name)){h(),e=p;break}e=f;break;case"Token":if(y!==null&&y.value===e.value){h(),e=p;break}e=f;break;case"Comma":y!==null&&y.type===me?ln(k.token)?e=f:(h(),e=on(y)?f:p):e=ln(k.token)||on(y)?p:f;break;case"String":let S="",D=b;for(;D<t.length&&S.length<e.value.length;D++)S+=t[D].value;if(dt(S,e.value)){for(;b<D;)h();e=p}else e=f;break;default:throw new Error("Unknown node type: "+e.type)}switch(W){case null:console.warn("[csstree-match] BREAK after "+sn+" iterations"),W=Ur,k=null;break;case an:for(;i!==null;)u();break;default:k=null}return{tokens:t,reason:W,iterations:kt,match:k,longestMatch:De}}function un(t,e,n){const a=zr(t,e,n||{});if(a.match===null)return a;let r=a.match,s=a.match={syntax:e.syntax||null,match:[]};const o=[s];for(r=Fr(r).prev;r!==null;){switch(r.type){case ft:s.match.push(s={syntax:r.syntax,match:[]}),o.push(s);break;case rn:o.pop(),s=o[o.length-1];break;default:s.match.push({syntax:r.syntax||null,token:r.token.value,node:r.token.node})}r=r.prev}return a}function cn(t){function e(r){return r===null?!1:r.type==="Type"||r.type==="Property"||r.type==="Keyword"}function n(r){if(Array.isArray(r.match)){for(let s=0;s<r.match.length;s++)if(n(r.match[s]))return e(r.syntax)&&a.unshift(r.syntax),!0}else if(r.node===t)return a=e(r.syntax)?[r.syntax]:[],!0;return!1}let a=null;return this.matched!==null&&n(this.matched),a}function Gr(t,e){return yt(this,t,n=>n.type==="Type"&&n.name===e)}function qr(t,e){return yt(this,t,n=>n.type==="Property"&&n.name===e)}function Rr(t){return yt(this,t,e=>e.type==="Keyword")}function yt(t,e,n){const a=cn.call(t,e);return a===null?!1:a.some(n)}var Wr=Object.freeze({__proto__:null,getTrace:cn,isKeyword:Rr,isProperty:qr,isType:Gr});let X=null;class A{static createItem(e){return{prev:null,next:null,data:e}}constructor(){this.head=null,this.tail=null,this.cursor=null}createItem(e){return A.createItem(e)}allocateCursor(e,n){let a;return X!==null?(a=X,X=X.cursor,a.prev=e,a.next=n,a.cursor=this.cursor):a={prev:e,next:n,cursor:this.cursor},this.cursor=a,a}releaseCursor(){const{cursor:e}=this;this.cursor=e.cursor,e.prev=null,e.next=null,e.cursor=X,X=e}updateCursors(e,n,a,r){let{cursor:s}=this;for(;s!==null;)s.prev===e&&(s.prev=n),s.next===a&&(s.next=r),s=s.cursor}*[Symbol.iterator](){for(let e=this.head;e!==null;e=e.next)yield e.data}get size(){let e=0;for(let n=this.head;n!==null;n=n.next)e++;return e}get isEmpty(){return this.head===null}get first(){return this.head&&this.head.data}get last(){return this.tail&&this.tail.data}fromArray(e){let n=null;this.head=null;for(let a of e){const r=A.createItem(a);n!==null?n.next=r:this.head=r,r.prev=n,n=r}return this.tail=n,this}toArray(){return[...this]}toJSON(){return[...this]}forEach(e,n=this){const a=this.allocateCursor(null,this.head);for(;a.next!==null;){const r=a.next;a.next=r.next,e.call(n,r.data,r,this)}this.releaseCursor()}forEachRight(e,n=this){const a=this.allocateCursor(this.tail,null);for(;a.prev!==null;){const r=a.prev;a.prev=r.prev,e.call(n,r.data,r,this)}this.releaseCursor()}reduce(e,n,a=this){let r=this.allocateCursor(null,this.head),s=n,o;for(;r.next!==null;)o=r.next,r.next=o.next,s=e.call(a,s,o.data,o,this);return this.releaseCursor(),s}reduceRight(e,n,a=this){let r=this.allocateCursor(this.tail,null),s=n,o;for(;r.prev!==null;)o=r.prev,r.prev=o.prev,s=e.call(a,s,o.data,o,this);return this.releaseCursor(),s}some(e,n=this){for(let a=this.head;a!==null;a=a.next)if(e.call(n,a.data,a,this))return!0;return!1}map(e,n=this){const a=new A;for(let r=this.head;r!==null;r=r.next)a.appendData(e.call(n,r.data,r,this));return a}filter(e,n=this){const a=new A;for(let r=this.head;r!==null;r=r.next)e.call(n,r.data,r,this)&&a.appendData(r.data);return a}nextUntil(e,n,a=this){if(e===null)return;const r=this.allocateCursor(null,e);for(;r.next!==null;){const s=r.next;if(r.next=s.next,n.call(a,s.data,s,this))break}this.releaseCursor()}prevUntil(e,n,a=this){if(e===null)return;const r=this.allocateCursor(e,null);for(;r.prev!==null;){const s=r.prev;if(r.prev=s.prev,n.call(a,s.data,s,this))break}this.releaseCursor()}clear(){this.head=null,this.tail=null}copy(){const e=new A;for(let n of this)e.appendData(n);return e}prepend(e){return this.updateCursors(null,e,this.head,e),this.head!==null?(this.head.prev=e,e.next=this.head):this.tail=e,this.head=e,this}prependData(e){return this.prepend(A.createItem(e))}append(e){return this.insert(e)}appendData(e){return this.insert(A.createItem(e))}insert(e,n=null){if(n!==null)if(this.updateCursors(n.prev,e,n,e),n.prev===null){if(this.head!==n)throw new Error("before doesn't belong to list");this.head=e,n.prev=e,e.next=n,this.updateCursors(null,e)}else n.prev.next=e,e.prev=n.prev,n.prev=e,e.next=n;else this.updateCursors(this.tail,e,null,e),this.tail!==null?(this.tail.next=e,e.prev=this.tail):this.head=e,this.tail=e;return this}insertData(e,n){return this.insert(A.createItem(e),n)}remove(e){if(this.updateCursors(e,e.prev,e,e.next),e.prev!==null)e.prev.next=e.next;else{if(this.head!==e)throw new Error("item doesn't belong to list");this.head=e.next}if(e.next!==null)e.next.prev=e.prev;else{if(this.tail!==e)throw new Error("item doesn't belong to list");this.tail=e.prev}return e.prev=null,e.next=null,e}push(e){this.insert(A.createItem(e))}pop(){return this.tail!==null?this.remove(this.tail):null}unshift(e){this.prepend(A.createItem(e))}shift(){return this.head!==null?this.remove(this.head):null}prependList(e){return this.insertList(e,this.head)}appendList(e){return this.insertList(e)}insertList(e,n){return e.head===null?this:(n!=null?(this.updateCursors(n.prev,e.tail,n,e.head),n.prev!==null?(n.prev.next=e.head,e.head.prev=n.prev):this.head=e.head,n.prev=e.tail,e.tail.next=n):(this.updateCursors(this.tail,e.tail,null,e.head),this.tail!==null?(this.tail.next=e.head,e.head.prev=this.tail):this.head=e.head,this.tail=e.tail),e.head=null,e.tail=null,this)}replace(e,n){"head"in n?this.insertList(n,e):this.insert(n,e),this.remove(e)}}function hn(t){return"node"in t?t.node:hn(t.match[0])}function pn(t){return"node"in t?t.node:pn(t.match[t.match.length-1])}function fn(t,e,n,a,r){function s(c){if(c.syntax!==null&&c.syntax.type===a&&c.syntax.name===r){const h=hn(c),l=pn(c);t.syntax.walk(e,function(u,i,m){if(u===h){const g=new A;do{if(g.appendData(i.data),i.data===l)break;i=i.next}while(i!==null);o.push({parent:m,nodes:g})}})}Array.isArray(c.match)&&c.match.forEach(s)}const o=[];return n.matched!==null&&s(n.matched),o}const{hasOwnProperty:ie}=Object.prototype;function mt(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&t>=0}function dn(t){return!!t&&mt(t.offset)&&mt(t.line)&&mt(t.column)}function _r(t,e){return function(n,a){if(!n||n.constructor!==Object)return a(n,"Type of node should be an Object");for(let r in n){let s=!0;if(ie.call(n,r)!==!1){if(r==="type")n.type!==t&&a(n,"Wrong node type `"+n.type+"`, expected `"+t+"`");else if(r==="loc"){if(n.loc===null)continue;if(n.loc&&n.loc.constructor===Object)if(typeof n.loc.source!="string")r+=".source";else if(!dn(n.loc.start))r+=".start";else if(!dn(n.loc.end))r+=".end";else continue;s=!1}else if(e.hasOwnProperty(r)){s=!1;for(let o=0;!s&&o<e[r].length;o++){const c=e[r][o];switch(c){case String:s=typeof n[r]=="string";break;case Boolean:s=typeof n[r]=="boolean";break;case null:s=n[r]===null;break;default:typeof c=="string"?s=n[r]&&n[r].type===c:Array.isArray(c)&&(s=n[r]instanceof A)}}}else a(n,"Unknown field `"+r+"` for "+t+" node type");s||a(n,"Bad value for `"+t+"."+r+"`")}}for(const r in e)ie.call(e,r)&&ie.call(n,r)===!1&&a(n,"Field `"+t+"."+r+"` is missed")}}function Vr(t,e){const n=e.structure,a={type:String,loc:!0},r={type:'"'+t+'"'};for(const s in n){if(ie.call(n,s)===!1)continue;const o=[],c=a[s]=Array.isArray(n[s])?n[s].slice():[n[s]];for(let h=0;h<c.length;h++){const l=c[h];if(l===String||l===Boolean)o.push(l.name);else if(l===null)o.push("null");else if(typeof l=="string")o.push("<"+l+">");else if(Array.isArray(l))o.push("List");else throw new Error("Wrong value `"+l+"` in `"+t+"."+s+"` structure definition")}r[s]=o.join(" | ")}return{docs:r,check:_r(t,a)}}function Jr(t){const e={};if(t.node){for(const n in t.node)if(ie.call(t.node,n)){const a=t.node[n];if(a.structure)e[n]=Vr(n,a);else throw new Error("Missed `structure` field in `"+n+"` node type definition")}}return e}const Zr=pt(wt.join(" | "));function gt(t,e,n){const a={};for(const r in t)t[r].syntax&&(a[r]=n?t[r].syntax:Ne(t[r].syntax,{compact:e}));return a}function Hr(t,e,n){const a={};for(const[r,s]of Object.entries(t))a[r]={prelude:s.prelude&&(n?s.prelude.syntax:Ne(s.prelude.syntax,{compact:e})),descriptors:s.descriptors&&gt(s.descriptors,e,n)};return a}function Yr(t){for(let e=0;e<t.length;e++)if(t[e].value.toLowerCase()==="var(")return!0;return!1}function M(t,e,n){return{matched:t,iterations:n,error:e,...Wr}}function ee(t,e,n,a){const r=Tr(n,t.syntax);let s;return Yr(r)?M(null,new Error("Matching for a tree with var() is not supported")):(a&&(s=un(r,t.cssWideKeywordsSyntax,t)),(!a||!s.match)&&(s=un(r,e.match,t),!s.match)?M(null,new vn(s.reason,e.syntax,n,s),s.iterations):M(s.match,null,s.iterations))}class Qr{constructor(e,n,a){if(this.cssWideKeywordsSyntax=Zr,this.syntax=n,this.generic=!1,this.units={...Ft},this.atrules=Object.create(null),this.properties=Object.create(null),this.types=Object.create(null),this.structure=a||Jr(e),e){if(e.units)for(const r of Object.keys(Ft))Array.isArray(e.units[r])&&(this.units[r]=e.units[r]);if(e.types)for(const r in e.types)this.addType_(r,e.types[r]);if(e.generic){this.generic=!0;for(const[r,s]of Object.entries(Hn(this.units)))this.addType_(r,s)}if(e.atrules)for(const r in e.atrules)this.addAtrule_(r,e.atrules[r]);if(e.properties)for(const r in e.properties)this.addProperty_(r,e.properties[r])}}checkStructure(e){function n(s,o){r.push({node:s,message:o})}const a=this.structure,r=[];return this.syntax.walk(e,function(s){a.hasOwnProperty(s.type)?a[s.type].check(s,n):n(s,"Unknown node type `"+s.type+"`")}),r.length?r:!1}createDescriptor(e,n,a,r=null){const s={type:n,name:a},o={type:n,name:a,parent:r,serializable:typeof e=="string"||e&&typeof e.type=="string",syntax:null,match:null};return typeof e=="function"?o.match=pt(e,s):(typeof e=="string"?Object.defineProperty(o,"syntax",{get(){return Object.defineProperty(o,"syntax",{value:Qt(e)}),o.syntax}}):o.syntax=e,Object.defineProperty(o,"match",{get(){return Object.defineProperty(o,"match",{value:pt(o.syntax,s)}),o.match}})),o}addAtrule_(e,n){n&&(this.atrules[e]={type:"Atrule",name:e,prelude:n.prelude?this.createDescriptor(n.prelude,"AtrulePrelude",e):null,descriptors:n.descriptors?Object.keys(n.descriptors).reduce((a,r)=>(a[r]=this.createDescriptor(n.descriptors[r],"AtruleDescriptor",r,e),a),Object.create(null)):null})}addProperty_(e,n){n&&(this.properties[e]=this.createDescriptor(n,"Property",e))}addType_(e,n){n&&(this.types[e]=this.createDescriptor(n,"Type",e))}checkAtruleName(e){if(!this.getAtrule(e))return new ne("Unknown at-rule","@"+e)}checkAtrulePrelude(e,n){const a=this.checkAtruleName(e);if(a)return a;const r=this.getAtrule(e);if(!r.prelude&&n)return new SyntaxError("At-rule `@"+e+"` should not contain a prelude");if(r.prelude&&!n&&!ee(this,r.prelude,"",!1).matched)return new SyntaxError("At-rule `@"+e+"` should contain a prelude")}checkAtruleDescriptorName(e,n){const a=this.checkAtruleName(e);if(a)return a;const r=this.getAtrule(e),s=Ke(n);if(!r.descriptors)return new SyntaxError("At-rule `@"+e+"` has no known descriptors");if(!r.descriptors[s.name]&&!r.descriptors[s.basename])return new ne("Unknown at-rule descriptor",n)}checkPropertyName(e){if(!this.getProperty(e))return new ne("Unknown property",e)}matchAtrulePrelude(e,n){const a=this.checkAtrulePrelude(e,n);if(a)return M(null,a);const r=this.getAtrule(e);return r.prelude?ee(this,r.prelude,n||"",!1):M(null,null)}matchAtruleDescriptor(e,n,a){const r=this.checkAtruleDescriptorName(e,n);if(r)return M(null,r);const s=this.getAtrule(e),o=Ke(n);return ee(this,s.descriptors[o.name]||s.descriptors[o.basename],a,!1)}matchDeclaration(e){return e.type!=="Declaration"?M(null,new Error("Not a Declaration node")):this.matchProperty(e.property,e.value)}matchProperty(e,n){if(vt(e).custom)return M(null,new Error("Lexer matching doesn't applicable for custom properties"));const a=this.checkPropertyName(e);return a?M(null,a):ee(this,this.getProperty(e),n,!0)}matchType(e,n){const a=this.getType(e);return a?ee(this,a,n,!1):M(null,new ne("Unknown type",e))}match(e,n){return typeof e!="string"&&(!e||!e.type)?M(null,new ne("Bad syntax")):((typeof e=="string"||!e.match)&&(e=this.createDescriptor(e,"Type","anonymous")),ee(this,e,n,!1))}findValueFragments(e,n,a,r){return fn(this,n,this.matchProperty(e,n),a,r)}findDeclarationValueFragments(e,n,a){return fn(this,e.value,this.matchDeclaration(e),n,a)}findAllFragments(e,n,a){const r=[];return this.syntax.walk(e,{visit:"Declaration",enter:s=>{r.push.apply(r,this.findDeclarationValueFragments(s,n,a))}}),r}getAtrule(e,n=!0){const a=Ke(e);return(a.vendor&&n?this.atrules[a.name]||this.atrules[a.basename]:this.atrules[a.name])||null}getAtrulePrelude(e,n=!0){const a=this.getAtrule(e,n);return a&&a.prelude||null}getAtruleDescriptor(e,n){return this.atrules.hasOwnProperty(e)&&this.atrules.declarators&&this.atrules[e].declarators[n]||null}getProperty(e,n=!0){const a=vt(e);return(a.vendor&&n?this.properties[a.name]||this.properties[a.basename]:this.properties[a.name])||null}getType(e){return hasOwnProperty.call(this.types,e)?this.types[e]:null}validate(){function e(r,s,o,c){if(o.has(s))return o.get(s);o.set(s,!1),c.syntax!==null&&Sr(c.syntax,function(h){if(h.type!=="Type"&&h.type!=="Property")return;const l=h.type==="Type"?r.types:r.properties,u=h.type==="Type"?n:a;(!hasOwnProperty.call(l,h.name)||e(r,h.name,u,l[h.name]))&&o.set(s,!0)},this)}let n=new Map,a=new Map;for(const r in this.types)e(this,r,n,this.types[r]);for(const r in this.properties)e(this,r,a,this.properties[r]);return n=[...n.keys()].filter(r=>n.get(r)),a=[...a.keys()].filter(r=>a.get(r)),n.length||a.length?{types:n,properties:a}:null}dump(e,n){return{generic:this.generic,units:this.units,types:gt(this.types,!n,e),properties:gt(this.properties,!n,e),atrules:Hr(this.atrules,!n,e)}}toString(){return JSON.stringify(this.dump())}}export{Qr as Lexer};
